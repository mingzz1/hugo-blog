<!DOCTYPE html>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
    rel="stylesheet">

<html class="no-js">
<head>
    <meta charset="utf-8">

    <base href="https://mingzz1.github.io/">
    <title> mingzzi&#39;s blog </title>
    <meta name="description" content="mingzzi&#39;s blog">

    <link rel="canonical" href="https://mingzz1.github.io/ctf/2018/2018/07/17/meepwn2018-writeup.html/">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />

    
    <link rel="stylesheet" href="https://mingzz1.github.io/sass/main.min.94d6e676b5b11c22f591951fd9b4e6ab0f6a3179daac45918d1fbc53ed631f00.css">

    <link rel="shortcut icon" href="https://mingzz1.github.io/img/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" type="text/css"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130304424-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-130304424-1');
    </script>

    
    <script data-ad-client="ca-pub-1587587893565234" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <script>
        $(function () {
            $(".cat1>li").click(function () {
                $(this).siblings().find('ul').slideUp(300);
                $(this).find('ul').slideToggle(300);
            })

            $(window).scroll(function () {
                activeBg();
            });

            activeBg();


            $('.h-menu').click(function (e) {
                e.preventDefault();
                $('.side').addClass('on');
            });

            $('.close').click(function (e) {
                e.preventDefault();
                $('.side').removeClass('on');
            });

            $('ul.slide>li').click(function () {
                if ($(this).find('.down').hasClass('on')) {
                    $(this).find('.down').removeClass('on');
                    $(this).find('.down').prev().stop().slideUp(500);
                } else {
                    $(this).find('.down').addClass('on');
                    $(this).find('.down').prev().stop().slideDown(500);
                }
            })
        })

        function activeBg() {
            if ($(window).scrollTop() > 0) {
                $('.site-header').addClass('on');
            } else {
                $('.site-header').removeClass('on');
            }
        }

    </script>
</head>
<header class="site-header">
    <h1 class="web-t" onclick="window.location.href='/'"><span>def</span><em> 천방지축 얼렁뚱땅
        </em><span>(</span><i>🤣</i><span>)</span>:<br />
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="nbsp">title =</span> 빙글빙글 돌아가는 우당탕탕 시큐로그
        <br />
    </h1>

    <h1 class="mob-t" onclick="window.location.href='/'">
        <span>천/얼/빙/돌(</span><i>🤣</i><span>)</span>
        <br />우당탕탕 시큐로그
    </h1>

    <nav>
        <div class="h-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="side">
            <div class="close">
                <span></span>
                <span></span>
            </div>
            <ul class="slide">
                <li class="on"><a href="#">All Post</a>
                </li>
                <li><a>Pentesting</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//pentesting/ios">iOS</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/android">Android</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/web">Web</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/cloud">Cloud</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Wargame</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//wargame/lord-of-sql-injection">Lord of SQL Injection</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/pwnable.kr">Pwnable.kr</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/wargame.kr">Wargame.kr</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/xss-game">XSS Game</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/owasp">OWASP-MSTG Crackmes</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>CTF</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//ctf/2018">2018</a></li>
                        <li><a href="https://mingzz1.github.io//ctf/2019">2019</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Error</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//error/linux">Linux</a></li>
                        <li><a href="https://mingzz1.github.io//error/windows">Windows</a></li>
                        <li><a href="https://mingzz1.github.io//error/python">Python</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Development</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//development/basic">Basic</a></li>
                        <li><a href="https://mingzz1.github.io//development/web">Web</a></li>
                        <li><a href="https://mingzz1.github.io//development/mobile">Mobile</a></li>
                        <li><a href="https://mingzz1.github.io//development/database">Database</a></li>
                        <li><a href="https://mingzz1.github.io//development/docker">Docker</a></li>
                        <li><a href="https://mingzz1.github.io//development/github-blog">Github Blog</a></li>
                        <li><a href="https://mingzz1.github.io//development/secure-coding">Secure Coding</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <hr />
                <li><a href="https://mingzz1.github.io//about">About</a></li>
                <li><a href="https://mingzz1.github.io//archive">Archive</a></li>
                <li><a href="https://mingzz1.github.io//tags">Tag</a></li>
            </ul>
        </div>
    </nav>
</header>

<body>
    <div class="content">
        
        

<article>
    <header>
        <h1 class="title">[MeePwn2018] WHITE SNOW, BLACK SHADOW / ESOR / EZCHALLZ Write up</h1>
        <p class="meta">
            2018-07-17
        </p>
    </header>
    <section class="post-content"><p>지난 주말에 <code>MeePwn CTF</code>가 있었다.
다른 일이 있어 풀타임으로 참여하진 못했는데, 그래도 쉬운 몇 문제를 풀어 Write-up을 작성 해 보았다.</p>
<h3 id="misc-white-snow-black-shadow">[MISC] WHITE SNOW, BLACK SHADOW</h3>
<p>첫 번째로 풀어본 문제는 <code>WHITE SNOW, BLACK SHADOW</code> 문제이다.
문제 정보는 아래와 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">Finally we caught the image in criminal communication.
But Holmes, why are they crying?
</code></pre></td></tr></table>
</div>
</div><p>문제 정보와 함께 첨부 파일을 다운받을 수 있다.
파일을 다운받아 압축을 풀면 <code>evidence.jpg</code>라는 사진 파일을 하나 얻을 수 있다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_01.jpg" alt=""></p>
<p>사진에는 딱히 이상이 없어보여, <code>Hex Editor</code>를 사용 해 헥스 값을 확인 해 보았다.
파일의 첫 부분은 정상적인 <code>JPG</code> 파일의 헤더가 있었다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_02.png" alt=""></p>
<p>그런데 맨 마지막 부분에서 아래와 같이 <code>message.pdf</code>라는 문자열과 <code>PK</code>가 있는 것을 찾을 수 있었다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_03.png" alt=""></p>
<p><code>PK</code>라는 파일 헤더를 어딘가에서 본 기억이 나 인터넷에 검색을 해 보았더니 <code>ZIP</code> 파일의 헤더라는 것을 알 수 있었다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_04.png" alt=""></p>
<p>사진과 같이, <code>ZIP</code> 파일의 헤더는 <code>50 4b 03 04</code>로 시작하게 된다.
사진 파일에서 <code>ZIP</code> 파일을 추출하기 위해, <code>50 4b 03 04</code>를 찾아 보았다.
그런데 찾아보니 <code>50 4b 05 06</code>은 있었지만 <code>50 4b 03 04</code>는 찾을 수 없었다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_05.png" alt=""></p>
<p>아마도 파일 헤더를 살짝 수정해 둔 것 같았다.
그래서 <code>evidence.jpg</code> 파일에서 <code>50 4b 05 06</code>을 <code>50 4b 03 04</code>로 패치해 준 뒤, <code>WinHex</code> 라는 툴을 이용 해 파일을 추출 해 보았다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_06.png" alt=""></p>
<p>그 결과 다음과 같이 압축 파일을 추출할 수 있었고, 압축 파일 안에는 <code>message.pdf</code> 파일이 있었다.
message.pdf의 내용은 다음과 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">“When you have eliminated the impossible, whatever remains, however improbable, must be the truth.”

– Sir Arthur Conan Doyle

What does that mean?
To me, this is all about logic. If you start with everything you can think of, and then eliminate those that are impossible, you are well on your way to a solution. That’s the first stage of solving any mystery, whether it’s a murder mystery in a book (or TV, or movie, or…) or somethingMeeyou expected to work, but didn’t. You have to eliminate all the things that it couldn’t possibly be, or you will have too many distractions. 

Once we clear out all the distractions, we can focus on what remains. Sometimes what is left is easy to believe, other times it can seem highly improbable. However, with the impossible eliminated, whatPwnremains are the only possible solutions. And oneCTFof them must be the truth.

Why is clearing out the impossible solutions important?
Sometimes, it can be hard to solve a{T3challenging situation even under the best of circumstances. A problem with lotsxt_of shiny things to look at can be distracting, and waste a great deal of our time.
While some impossibilities might be obvious, sometimesUndwe can be sucked in by an idea that3r_intrigues us, despite being impossible. Other times, it is only in close examination that the impossibility is revealed.

However, once we clear the clutter by removing all that is impossible, we are left with an easier solution. Gone are the impossibilities, botht3Xobvious and subtle. What is left can be gone over more quickly, and evaluated for probability or even likelihood.

This may be an iterative process, starting with the really obvious impossibilities, and then moving to the shiny distractions. Finally, as wet!!!!}work our way through the last of the options, we may still find ourselves weeding out additional impossibilities.
</code></pre></td></tr></table>
</div>
</div><p>처음엔 딱히 이상한 점을 못느꼈는데, 자세히 읽어보니 띄어쓰기가 있어야 하는 부분에 문자열이 조금씩 들어있는 것을 발견할 수 있었다.</p>
<blockquote>
<p>ex) or something<code>Mee</code>you expected to work,</p>
</blockquote>
<p>문장을 하나하나 읽어보며 띄어쓰기가 있어야 하는 자리에 들어 있는 문자열을 잘라 이어보면 flag를 완성할 수 있다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">FLAG : MeePwnCTF{T3xt_Und3r_t3Xt!!!!}
</code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="crypto-esor">[CRYPTO] ESOR</h3>
<p>문제 정보는 다음과 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">Howdy, howdy...
nc 206.189.92.209 12345
</code></pre></td></tr></table>
</div>
</div><p>또한 함께 아래와 같은 파이썬 코드를 준다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/python2</span>
<span style="color:#ff79c6">from</span> Crypto.Cipher <span style="color:#ff79c6">import</span> AES
<span style="color:#ff79c6">import</span> hmac<span style="color:#ff79c6">,</span> hashlib
<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">import</span> sys

menu <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;&#34;Choose one:
</span><span style="color:#f1fa8c">1. encrypt data
</span><span style="color:#f1fa8c">2. decrypt data
</span><span style="color:#f1fa8c">3. quit
</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>

<span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Unbuffered</span>(<span style="color:#8be9fd;font-style:italic">object</span>):
    <span style="color:#ff79c6">def</span> __init__(self, stream):
        self<span style="color:#ff79c6">.</span>stream <span style="color:#ff79c6">=</span> stream
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">write</span>(self, data):
        self<span style="color:#ff79c6">.</span>stream<span style="color:#ff79c6">.</span>write(data)
        self<span style="color:#ff79c6">.</span>stream<span style="color:#ff79c6">.</span>flush()
    <span style="color:#ff79c6">def</span> __getattr__(self, attr):
        <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">getattr</span>(self<span style="color:#ff79c6">.</span>stream, attr)

sys<span style="color:#ff79c6">.</span>stdout <span style="color:#ff79c6">=</span> Unbuffered(sys<span style="color:#ff79c6">.</span>stdout)
sys<span style="color:#ff79c6">.</span>stderr <span style="color:#ff79c6">=</span> None

encrypt_key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\xff</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">32</span>
secret <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;MeePwnCTF{#flag_here#}&#39;</span>
hmac_secret <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
blocksize <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">16</span>
hmac_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">20</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">pad</span>(msg):
	padlen <span style="color:#ff79c6">=</span> blocksize <span style="color:#ff79c6">-</span> (<span style="color:#8be9fd;font-style:italic">len</span>(msg) <span style="color:#ff79c6">%</span> blocksize) <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>
	<span style="color:#ff79c6">return</span> os<span style="color:#ff79c6">.</span>urandom(padlen) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">chr</span>(padlen)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">unpad</span>(msg):
	<span style="color:#ff79c6">return</span> msg[:<span style="color:#ff79c6">-</span>(<span style="color:#8be9fd;font-style:italic">ord</span>(msg[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>)]

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">compute_hmac</span>(msg):
	<span style="color:#ff79c6">return</span> hmac<span style="color:#ff79c6">.</span>new(hmac_secret, msg, digestmod<span style="color:#ff79c6">=</span>hashlib<span style="color:#ff79c6">.</span>sha1)<span style="color:#ff79c6">.</span>digest()

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">encrypt</span>(prefix<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;&#39;</span>, suffix<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;&#39;</span>):
	_enc <span style="color:#ff79c6">=</span> prefix <span style="color:#ff79c6">+</span> secret <span style="color:#ff79c6">+</span> suffix
	_enc<span style="color:#ff79c6">+=</span> compute_hmac(_enc)
	_enc<span style="color:#ff79c6">+=</span> pad(_enc)
	iv <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>urandom(<span style="color:#bd93f9">16</span>)
	_aes <span style="color:#ff79c6">=</span> AES<span style="color:#ff79c6">.</span>new(encrypt_key, AES<span style="color:#ff79c6">.</span>MODE_CBC, iv)
	<span style="color:#ff79c6">return</span> (iv <span style="color:#ff79c6">+</span> _aes<span style="color:#ff79c6">.</span>encrypt(_enc))<span style="color:#ff79c6">.</span>encode(<span style="color:#f1fa8c">&#39;hex&#39;</span>)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">decrypt</span>(data):
	data <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>decode(<span style="color:#f1fa8c">&#39;hex&#39;</span>)
	<span style="color:#ff79c6">try</span>:
		iv <span style="color:#ff79c6">=</span> data[:blocksize]
		_aes <span style="color:#ff79c6">=</span> AES<span style="color:#ff79c6">.</span>new(encrypt_key, AES<span style="color:#ff79c6">.</span>MODE_CBC, iv)
		data <span style="color:#ff79c6">=</span> _aes<span style="color:#ff79c6">.</span>decrypt(data[blocksize:])
		data <span style="color:#ff79c6">=</span> unpad(data)
		plaintext <span style="color:#ff79c6">=</span> data[:<span style="color:#ff79c6">-</span>hmac_size]
		mac <span style="color:#ff79c6">=</span> data[<span style="color:#ff79c6">-</span>hmac_size:]
		<span style="color:#ff79c6">if</span> mac <span style="color:#ff79c6">==</span> compute_hmac(plaintext): <span style="color:#ff79c6">return</span> True
		<span style="color:#ff79c6">else</span>: <span style="color:#ff79c6">return</span> False
	<span style="color:#ff79c6">except</span>: <span style="color:#ff79c6">return</span> False

<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#34;&#34;&#34;Welcome to our super secure enc/dec server. 
</span><span style="color:#f1fa8c">We use hmac, so, plz don&#39;t hack us (and you can&#39;t). Thanks.&#34;&#34;&#34;</span>

<span style="color:#ff79c6">while</span> True:
	choice <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#8be9fd;font-style:italic">raw_input</span>(menu))
	<span style="color:#ff79c6">if</span> choice <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>:
		_pre <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">raw_input</span>(<span style="color:#f1fa8c">&#39;prefix: &#39;</span>)
		_suf <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">raw_input</span>(<span style="color:#f1fa8c">&#39;suffix: &#39;</span>)
		<span style="color:#ff79c6">print</span> encrypt(prefix<span style="color:#ff79c6">=</span>_pre, suffix<span style="color:#ff79c6">=</span>_suf)
	<span style="color:#ff79c6">elif</span> choice <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">2</span>:
		_data <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">raw_input</span>(<span style="color:#f1fa8c">&#39;data: &#39;</span>)
		<span style="color:#ff79c6">if</span> decrypt(_data):
			<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#39;OK&#39;</span>
		<span style="color:#ff79c6">else</span>:
			<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#39;KO&#39;</span>
	<span style="color:#ff79c6">elif</span> choice <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">3</span>:
		sys<span style="color:#ff79c6">.</span>exit(<span style="color:#bd93f9">0</span>)
	<span style="color:#ff79c6">else</span>:
		choice <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#8be9fd;font-style:italic">raw_input</span>(menu))
</code></pre></td></tr></table>
</div>
</div><p>서버에 실제로 저장되어 있는 <code>secret</code>의 값을 찾아야 하는 문제이다.
nc를 통해 문제에 접속하면 아래와 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ nc 206.189.92.209 12345
Welcome to our super secure enc/dec server. 
We use hmac, so, plz don<span style="color:#f1fa8c">&#39;t hack us (and you can&#39;</span>t<span style="color:#ff79c6">)</span>. Thanks.
Choose one:
1. encrypt data
2. decrypt data
3. quit
1
prefix: aaa
suffix: bbb
d9d860ba5708b4758a95b84b99459683dde5d09d8a137f2d436cf6b42d3519b3eb5642f9802c5957c867f0d83505462aa9f5d6024238c8618cff0832a15913446e0ff402ffb874968b2ce4b960e37517b557f32570ead1b3cd8e8ff6bf1a907b
Choose one:
1. encrypt data
2. decrypt data
3. quit
2
data: d9d860ba5708b4758a95b84b99459683dde5d09d8a137f2d436cf6b42d3519b3eb5642f9802c5957c867f0d83505462aa9f5d6024238c8618cff0832a15913446e0ff402ffb874968b2ce4b960e37517b557f32570ead1b3cd8e8ff6bf1a907b
OK
Choose one:
1. encrypt data
2. decrypt data
3. quit
</code></pre></td></tr></table>
</div>
</div><p><code>encrypt data</code>, <code>decrypt data</code>, <code>quit</code> 3 개의 메뉴가 있고, <code>encrypt data</code>를 선택 할 경우 <code>prefix</code>와 <code>suffix</code>를 입력 해 주어야 한다.
또한 <code>decrypt data</code>를 선택 할 경우에는 복호화 할 데이터를 입력받고 복호화 성공 시 <code>OK</code>를, 복호화를 실패 할 경우에는 <code>KO</code>를 출력 해 준다.
소스코드를 확인 해 보면 <code>decrypt</code> 함수를 제공 해 주었으며, <code>encrypt_key</code>가 <code>0xff * 32</code>로 되어 있다.
그래서 혹시나 해서 다음과 같이 제공해 준 <code>decrypt</code> 함수를 바탕으로 exploit 코드를 짠 후 돌려 보았다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/python2</span>
<span style="color:#ff79c6">from</span> Crypto.Cipher <span style="color:#ff79c6">import</span> AES
<span style="color:#ff79c6">import</span> hmac<span style="color:#ff79c6">,</span> hashlib
<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>

<span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Unbuffered</span>(<span style="color:#8be9fd;font-style:italic">object</span>):
    <span style="color:#ff79c6">def</span> __init__(self, stream):
        self<span style="color:#ff79c6">.</span>stream <span style="color:#ff79c6">=</span> stream
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">write</span>(self, data):
        self<span style="color:#ff79c6">.</span>stream<span style="color:#ff79c6">.</span>write(data)
        self<span style="color:#ff79c6">.</span>stream<span style="color:#ff79c6">.</span>flush()
    <span style="color:#ff79c6">def</span> __getattr__(self, attr):
        <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">getattr</span>(self<span style="color:#ff79c6">.</span>stream, attr)

sys<span style="color:#ff79c6">.</span>stdout <span style="color:#ff79c6">=</span> Unbuffered(sys<span style="color:#ff79c6">.</span>stdout)
sys<span style="color:#ff79c6">.</span>stderr <span style="color:#ff79c6">=</span> None

encrypt_key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\xff</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">32</span>
hmac_secret <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
blocksize <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">16</span>
hmac_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">20</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">unpad</span>(msg):
	<span style="color:#ff79c6">return</span> msg[:<span style="color:#ff79c6">-</span>(<span style="color:#8be9fd;font-style:italic">ord</span>(msg[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>)]

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">compute_hmac</span>(msg):
	<span style="color:#ff79c6">return</span> hmac<span style="color:#ff79c6">.</span>new(hmac_secret, msg, digestmod<span style="color:#ff79c6">=</span>hashlib<span style="color:#ff79c6">.</span>sha1)<span style="color:#ff79c6">.</span>digest()

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">decrypt</span>(data):
	data <span style="color:#ff79c6">=</span> data<span style="color:#ff79c6">.</span>decode(<span style="color:#f1fa8c">&#39;hex&#39;</span>)
	<span style="color:#ff79c6">try</span>:
		iv <span style="color:#ff79c6">=</span> data[:blocksize]
		_aes <span style="color:#ff79c6">=</span> AES<span style="color:#ff79c6">.</span>new(encrypt_key, AES<span style="color:#ff79c6">.</span>MODE_CBC, iv)
		data <span style="color:#ff79c6">=</span> _aes<span style="color:#ff79c6">.</span>decrypt(data[blocksize:])
		data <span style="color:#ff79c6">=</span> unpad(data)
		plaintext <span style="color:#ff79c6">=</span> data[:<span style="color:#ff79c6">-</span>hmac_size]
		mac <span style="color:#ff79c6">=</span> data[<span style="color:#ff79c6">-</span>hmac_size:]
		<span style="color:#ff79c6">if</span> mac <span style="color:#ff79c6">==</span> compute_hmac(plaintext):
			<span style="color:#ff79c6">print</span> plaintext
			<span style="color:#ff79c6">return</span> True
		<span style="color:#ff79c6">else</span>: <span style="color:#ff79c6">return</span> False
	<span style="color:#ff79c6">except</span>: <span style="color:#ff79c6">return</span> False

<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#34;[+] ESOR exploit start&#34;</span>

s <span style="color:#ff79c6">=</span> remote(<span style="color:#f1fa8c">&#34;206.189.92.209&#34;</span>, <span style="color:#bd93f9">12345</span>)

<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#34;[+] Connect OK with ESOR&#34;</span> 

s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#34;3. quit&#34;</span>)

s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#34;1&#34;</span>)

s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#34;prefix: &#34;</span>)
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#34;aaa&#34;</span>)
s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#34;suffix: &#34;</span>)
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#34;bbb&#34;</span>)

recv_data <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#34;3. quit&#34;</span>)

data <span style="color:#ff79c6">=</span> recv_data<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#34;Choose one:&#34;</span>)[<span style="color:#bd93f9">0</span>][:<span style="color:#bd93f9">192</span>]

<span style="color:#ff79c6">print</span> data

<span style="color:#ff79c6">print</span> <span style="color:#f1fa8c">&#34;[+] Check Encrypted data OK&#34;</span>

decrypt(data)
</code></pre></td></tr></table>
</div>
</div><p>nc로 접속한 후, 암호화 된 데이터를 받아 제공해 준 <code>decrypt</code> 함수를 사용 해 복호화 한 후 <code>print plaintext</code>만 추가 해 주었다.
그 결과 앞 뒤로 내가 입력 한 <code>prefix</code>와 <code>suffix</code>가 있는 flag를 얻을 수 있었다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">FLAG : MeePwnCTF{pooDL3-this-is-la-vie-en-rose-P00dle!}
</code></pre></td></tr></table>
</div>
</div><p>아무래도 이 문제는 출제자가 잘못 낸 문제같다.
flag의 내용으로 추측하건데, 아마도 <code>POODLE</code> 공격을 해야하는 문제가 아니었나 싶다.
그런데, 오늘 다시 코드를 돌려보니 이제는 문제가 풀리지 않았다.
대회 도중 출제자가 잘못된 것을 깨닫고 문제를 수정한 것 같다.
<del>IRC는 모르겠지만 홈페이지에는 공지가 없었다&hellip; 잠수함 패치 잼&hellip;</del></p>
<hr>
<h3 id="crypto-ezchallz">[CRYPTO] EZCHALLZ</h3>
<p>문제 정보는 아래와 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">http://206.189.92.209/ezchallz/
</code></pre></td></tr></table>
</div>
</div><p>홈페이지에 접속 해 보면 아래와 같은 화면만 있다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_07.png" alt=""></p>
<p><code>Homepage</code>와 <code>Free register</code>, 딱 두개의 메뉴만 있을 뿐이었다.
<code>Homepage</code>를 누르면 위와 동일한 화면이 나타난다.
<code>Free register</code>를 누를 경우에는 아래와 같이 값을 입력할 수 있으며, <code>Register</code> 버튼을 누르면 가짜 flag를 출력 해 준다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_08.png" alt=""></p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_09.png" alt=""></p>
<p>소스코드를 봐도 딱히 눈에 띄는것이 없어 <code>URL</code>을 살펴 보았다.
각각 버튼을 누를 경우 이동하는 URL은 다음과 같다.</p>
<blockquote>
<p>Homepage를 누를 경우 : http://206.189.92.209/ezchallz/index.php<br>
Free register를 누를 경우 : http://206.189.92.209/ezchallz/index.php?page=register<br>
값 입력 후 Register 버튼을 누를 경우 : http://206.189.92.209/ezchallz/users/b8240bb93fb5c4321196ff675b7f98eb/flag.php</p>
</blockquote>
<p>쿼리 스트링에서 <code>page</code>를 인자로 받아 페이지를 이동한다는 것을 알 수 있었다.
그런데 이 경우 <code>LFI</code> 공격에 취약할 수 있다.
<code>page</code>의 값에 다음과 같이 입력한다면, 해당 파일의 내용을 읽을 수 있다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">?page=php://filter/convert.base64-encode/resource=index
</code></pre></td></tr></table>
</div>
</div><p>그 결과 아래와 같이 <code>base64</code>로 인코딩 된 소스코드를 얻을 수 있었다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_10.png" alt=""></p>
<p><code>index</code>와 <code>register</code> 페이지의 소스코드를 얻어 <code>base64</code>로 디코딩 하면 아래와 같다.</p>
<ul>
<li>index.php</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">&lt;<span style="color:#ff79c6">html</span>&gt;
&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;index.php&#34;</span>&gt;Homepage&lt;/<span style="color:#ff79c6">a</span>&gt;
&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;?page=register&#34;</span>&gt;Free register&lt;/<span style="color:#ff79c6">a</span>&gt;&lt;/<span style="color:#ff79c6">li</span>&gt;

<span style="color:#ff79c6">&lt;?php</span>
<span style="color:#ff79c6">if</span>(isset(<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#34;page&#34;</span>]) <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span><span style="color:#ff79c6">empty</span>(<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#34;page&#34;</span>])) {
    <span style="color:#8be9fd;font-style:italic">$page</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#34;page&#34;</span>];
    <span style="color:#ff79c6">if</span>(strpos(strtolower(<span style="color:#8be9fd;font-style:italic">$page</span>), <span style="color:#f1fa8c">&#39;secret&#39;</span>) <span style="color:#ff79c6">!==</span> <span style="color:#ff79c6">false</span>) {
        <span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#39;No no no!&#39;</span>);
    }
<span style="color:#6272a4">//    else if(strpos($page, &#39;php&#39;) !== false) {
</span><span style="color:#6272a4"></span> <span style="color:#6272a4">//       die(&#34;N0 n0 n0!&#34;);
</span><span style="color:#6272a4">//    }
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">else</span> {
        <span style="color:#ff79c6">include</span>(<span style="color:#8be9fd;font-style:italic">$page</span> <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#39;.php&#39;</span>);
    }
}
<span style="color:#ff79c6">?&gt;</span>
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><ul>
<li>register.php</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">&lt;<span style="color:#ff79c6">html</span>&gt;
<span style="color:#ff79c6">&lt;?php</span>
error_reporting(<span style="color:#bd93f9">0</span>);

<span style="color:#ff79c6">function</span> <span style="color:#50fa7b">gendirandshowflag</span>(<span style="color:#8be9fd;font-style:italic">$username</span>) {
	<span style="color:#ff79c6">include</span>(<span style="color:#f1fa8c">&#39;secret.php&#39;</span>);
	<span style="color:#8be9fd;font-style:italic">$dname</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;
	<span style="color:#8be9fd;font-style:italic">$intro</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;
	<span style="color:#8be9fd;font-style:italic">$_username</span> <span style="color:#ff79c6">=</span> md5(<span style="color:#8be9fd;font-style:italic">$username</span>, <span style="color:#8be9fd;font-style:italic">$raw_output</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">TRUE</span>);
	<span style="color:#ff79c6">for</span>(<span style="color:#8be9fd;font-style:italic">$i</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; <span style="color:#8be9fd;font-style:italic">$i</span><span style="color:#ff79c6">&lt;</span>strlen(<span style="color:#8be9fd;font-style:italic">$salt</span>); <span style="color:#8be9fd;font-style:italic">$i</span><span style="color:#ff79c6">++</span>) {
		<span style="color:#8be9fd;font-style:italic">$dname</span><span style="color:#ff79c6">.=</span> chr(ord(<span style="color:#8be9fd;font-style:italic">$salt</span>[<span style="color:#8be9fd;font-style:italic">$i</span>]) <span style="color:#ff79c6">^</span> ord(<span style="color:#8be9fd;font-style:italic">$_username</span>[<span style="color:#8be9fd;font-style:italic">$i</span>]));
	};
	<span style="color:#8be9fd;font-style:italic">$dname</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;users/&#34;</span> <span style="color:#ff79c6">.</span> bin2hex(<span style="color:#8be9fd;font-style:italic">$dname</span>);
	<span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#39;You have successfully register as &#39;</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$username</span> <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#39;!\n&#39;</span>;
	<span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$_username</span> <span style="color:#ff79c6">===</span> hex2bin(<span style="color:#f1fa8c">&#39;21232f297a57a5a743894a0e4a801fc3&#39;</span>)) {
		<span style="color:#8be9fd;font-style:italic">$intro</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Here is your flag:&#34;</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$flag</span>;
	}
	<span style="color:#ff79c6">else</span> {
		<span style="color:#8be9fd;font-style:italic">$intro</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Here is your flag, but I&#39;m not sure 🤔: </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">MeePwnCTF{&#34;</span> <span style="color:#ff79c6">.</span> md5(random_bytes(<span style="color:#bd93f9">16</span>) <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$username</span>) <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#34;}&#34;</span>;
	}
	mkdir(<span style="color:#8be9fd;font-style:italic">$dname</span>);
	file_put_contents(<span style="color:#8be9fd;font-style:italic">$dname</span> <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#39;/flag.php&#39;</span>, <span style="color:#8be9fd;font-style:italic">$intro</span>);
	header(<span style="color:#f1fa8c">&#34;Location: &#34;</span><span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$dname</span> <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#34;/flag.php&#34;</span>);
}

<span style="color:#ff79c6">if</span> (isset(<span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;username&#39;</span>])) {
	<span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;username&#39;</span>] <span style="color:#ff79c6">===</span> <span style="color:#f1fa8c">&#39;admin&#39;</span>) {
		<span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#39;Username is not allowed!&#39;</span>);
	}
	<span style="color:#ff79c6">else</span> {
		gendirandshowflag(<span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;username&#39;</span>]);
	}
}
<span style="color:#ff79c6">?&gt;</span>

        &lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;?page=register&#34;</span> <span style="color:#50fa7b">method</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;POST&#34;</span>&gt;
        &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;username&#34;</span>&gt;&lt;<span style="color:#ff79c6">br</span>&gt;
        &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Register&#34;</span>&gt;
        &lt;/<span style="color:#ff79c6">form</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>소스코드를 분석해 본 결과, username의 md5 해쉬 값이 <code>21232f297a57a5a743894a0e4a801fc3</code>라면 진짜 flag를 <code>$dname/flag.php</code>에 저장하는 것을 알 수 있었다.
즉, md5 해쉬 값이 <code>21232f297a57a5a743894a0e4a801fc3</code>인 username을 찾아 해당 <code>username</code>의 <code>$dname</code>을 구해 <code>$dname/flag.php</code>에 들어가면 flag를 얻을 수 있다.
<code>$dname</code>을 만드는 코드는 다음과 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">for($i = 0; $i&lt;<span style="color:#ff79c6">strlen</span>($<span style="color:#50fa7b">salt</span>); $<span style="color:#50fa7b">i</span>++) {
	$<span style="color:#50fa7b">dname</span>.= <span style="color:#50fa7b">chr</span>(<span style="color:#50fa7b">ord</span>($<span style="color:#50fa7b">salt</span>[$<span style="color:#50fa7b">i</span>]) ^ <span style="color:#50fa7b">ord</span>($<span style="color:#50fa7b">_username</span>[$<span style="color:#50fa7b">i</span>]));
};
</code></pre></td></tr></table>
</div>
</div><p>따라서 <code>$dname</code>을 만들기 위해서는 <code>$salt</code>의 값과 <code>$_username</code>의 값을 알아야 한다.
인터넷의 해쉬 값을 크랙해 주는 사이트에서 <code>21232f297a57a5a743894a0e4a801fc3</code>의 평문은 <code>admin</code>이라는 것을 알아내어, <code>$_username</code>은 <code>admin</code>이라는 것을 알 수 있었다.</p>
<p>문제는 <code>$salt</code> 값인데, 변수를 새로 선언도 안한 것으로 보아 <code>$salt</code>의 값은 <code>secret.php</code>에 있는 것 같다.
하지만 <code>index.php</code>에서 <code>secret</code>라는 문자에 대한 필터링을 걸어 두었으므로, <code>secret.php</code>의 소스코드는 알아낼 수 없다.
그렇지만 <code>$dname</code>을 만들 때 <code>XOR</code> 연산을 사용하며, 홈페이지에서 내가 입력한 값을 바탕으로 만들어 지는 <code>$dname</code>의 값을 확인할 수 있다.</p>
<p>따라서 이를 역 연산하면 <code>$salt</code>의 값을 알아낼 수 있다.
<code>$salt</code>의 값을 구하고, <code>admin</code>의 <code>$dname</code>을 구하기 위해 아래와 같이 소스코드를 구현 했다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#ff79c6">&lt;?php</span>
	<span style="color:#8be9fd;font-style:italic">$_username</span> <span style="color:#ff79c6">=</span> md5(<span style="color:#f1fa8c">&#34;test&#34;</span>, <span style="color:#8be9fd;font-style:italic">$raw_output</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">TRUE</span>);

	<span style="color:#8be9fd;font-style:italic">$_dname</span> <span style="color:#ff79c6">=</span> hex2bin(<span style="color:#f1fa8c">&#34;b8240bb93fb5c4321196ff675b7f98eb&#34;</span>);

	<span style="color:#8be9fd;font-style:italic">$salt</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;

	<span style="color:#ff79c6">for</span>(<span style="color:#8be9fd;font-style:italic">$i</span>; <span style="color:#8be9fd;font-style:italic">$i</span> <span style="color:#ff79c6">&lt;</span> strlen(<span style="color:#8be9fd;font-style:italic">$_username</span>); <span style="color:#8be9fd;font-style:italic">$i</span> <span style="color:#ff79c6">++</span>) {
		<span style="color:#8be9fd;font-style:italic">$salt</span> <span style="color:#ff79c6">.=</span> chr(ord(<span style="color:#8be9fd;font-style:italic">$_dname</span>[<span style="color:#8be9fd;font-style:italic">$i</span>]) <span style="color:#ff79c6">^</span> ord(<span style="color:#8be9fd;font-style:italic">$_username</span>[<span style="color:#8be9fd;font-style:italic">$i</span>]));
	}

	<span style="color:#8be9fd;font-style:italic">$_username</span> <span style="color:#ff79c6">=</span> md5(<span style="color:#f1fa8c">&#34;admin&#34;</span>, <span style="color:#8be9fd;font-style:italic">$raw_output</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">TRUE</span>);
	<span style="color:#8be9fd;font-style:italic">$dname</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;

	<span style="color:#ff79c6">for</span>(<span style="color:#8be9fd;font-style:italic">$i</span> <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; <span style="color:#8be9fd;font-style:italic">$i</span> <span style="color:#ff79c6">&lt;</span> strlen(<span style="color:#8be9fd;font-style:italic">$_username</span>); <span style="color:#8be9fd;font-style:italic">$i</span> <span style="color:#ff79c6">++</span>) {
		<span style="color:#8be9fd;font-style:italic">$dname</span><span style="color:#ff79c6">.=</span> chr(ord(<span style="color:#8be9fd;font-style:italic">$salt</span>[<span style="color:#8be9fd;font-style:italic">$i</span>]) <span style="color:#ff79c6">^</span> ord(<span style="color:#8be9fd;font-style:italic">$_username</span>[<span style="color:#8be9fd;font-style:italic">$i</span>]));
    }
	<span style="color:#ff79c6">echo</span> bin2hex(<span style="color:#8be9fd;font-style:italic">$dname</span>);
<span style="color:#ff79c6">?&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>그 결과 <code>90884f5d03c3b2e698c1fbea37d833de</code>라는 <code>$dname</code> 값을 구할 수 있었다.
<code>90884f5d03c3b2e698c1fbea37d833de/flag.php</code>로 접속 해 주석을 확인 해보면 flag를 얻을 수 있다.</p>
<p><img src="/images/CTF/MeePwn2018/solved/meepwn_11.png" alt=""></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">FLAG : MeePwnCTF{just-a-warmup-challenge-are-you-ready-for-hacking-others-challz?}
</code></pre></td></tr></table>
</div>
</div></section>
    <footer>
    <div class="tags">
        
        <a href="https://mingzz1.github.io//tags#Write-up">#Write-up</a>
        
        <a href="https://mingzz1.github.io//tags#CTF">#CTF</a>
        
        <a href="https://mingzz1.github.io//tags#MeePwn2018">#MeePwn2018</a>
        
    </div>
</footer>
</article>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mingzzis-blog';
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
</div>

<div id="post-nav">
    <div id="previous-post" class="post-nav-post">
        
        <p>Previous post</p>
        <a href="https://mingzz1.github.io/wargame/xss-game/2018/06/27/xssgame-writeup.html/">[XSS Game] Write up</a>
        
    </div>

    <div id="next-post" class="post-nav-post">
        
        <p>Next post</p>
        <a href="https://mingzz1.github.io/ctf/2018/2018/07/18/ctf-meepwn2018-omegasector.html/">[MeePwn2018] OMEGASECTOR Write up</a>
        
    </div>
</div>


    </div>
    <ul class='social'>
    
    <li>
        <a href="https://github.com/mingzz1" class="icon alt" target="_blank">
            <i class="fa fa-github fa-2x"></i>
        </a>
    </li>
    
    <li>
        <a href="https://www.linkedin.com/in/minji-kim-12986a145/" class="icon alt" target="_blank">
            <i class="fa fa-linkedin fa-2x"></i>
        </a>
    </li>
    
</ul>
<footer class="site-footer">
    <p ckass="text">Powered by <a href="https://mingzz1.github.io" target="_blank">mingzzi</a> with <a
            href="https://skye3133.github.io/" target="_blank">myund</a></p>
</footer>

    <script id="dsq-count-scr" src="//mingzzis-blog.disqus.com/count.js" async></script>

    
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-130304424-1']);
    _gaq.push(['_trackPageview']);
    (function () {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
    
</body>
</body>

</html>